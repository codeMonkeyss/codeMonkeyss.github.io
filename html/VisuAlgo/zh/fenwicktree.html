<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="description" content="A Binary Indexed (Fenwick) Tree is a data structure that provides efficient methods for implementing dynamic cumulative frequency tables (described in the next slide).In this visualization, we will refer to this data structure using the term Fenwick Tree as the abbreviation &#39;BIT&#39; of Binary Indexed Tree is usually associated with bit manipulation.">
<meta name="keywords" content="Binary Indexed Tree BIT Fenwick Dynamic Range Sum Point Update">
 
<meta name="csrf-token" content="kaTPcaTtnnJPvGspW7LRTya6UONjjAL7yXZSCSBh">
<meta http-equiv="X-UA-Compatible" content="IE=EDGE">
<meta property="og:image" content="../img/png/fenwicktree.png">
<title>VisuAlgo - Binary Indexed (Fenwick) Tree</title>
<link rel="icon" href="../img/favicon.png" type="image/x-icon">
<link rel="shortcut icon" href="../img/favicon.png" type="image/x-icon">
<link rel="apple-touch-icon" href="../img/favicon.png">
<link rel="apple-touch-icon" sizes="72x72" href="../img/favicon.png">
<link rel="apple-touch-icon" sizes="114x114" href="../img/favicon.png">
<link rel="stylesheet" type="text/css" href="../fonts/silkscreen/stylesheet.css">
<link rel="stylesheet" type="text/css" href="../css/common.css">
<link rel="stylesheet" href="../css/viz-1.0.1.css">
<link rel="stylesheet" href="../css/visual.css">
<link rel="stylesheet" href="../css/drawgraph.css">
<style>
      #e-lecture {
        top: 45px;
        right: 130px;
        width: 400px;
        display: block;
        background: none;
        /*overflow: normal;*/
        white-space: normal;
        text-align: right;
        color: black; font-weight: bold; font-size: 20px;
      }
      .electure-prev, .electure-next { /* force update, copied from viz.css */
        position: absolute;
        /* bottom: -12px; */
        top: -20px;
        /*bottom: '';*/
        padding: 3px 8px;
        background: #999;
        color: white;
        cursor: pointer;
        border-radius: 2px;
      }
      .electure-prev {
        left: -10px;
        /* right: 30px; */
      }
      .electure-next {
        right: -10px;
        color: white;
      }
    </style>
<style>
.update { bottom: 60px;}
.update p { padding: 5px 8px;}
#update-input input {
  width: 25px;
  padding: 8px;
}
#update-go p { padding: 8px 8px 7px; }

.query { bottom: 90px;}
.query p { padding: 5px 8px;}
#query-input input {
  width: 25px;
  padding: 8px;
}
#query-go p { padding: 8px 8px 7px; }

.create { bottom: 119px;}
#create-input input {
  width: 200px;
  padding: 8px;
}
#create-go p { padding: 8px 8px 7px; }
#create-randomize p { padding: 8px 8px 7px; }
</style>
<script>
      function changeURL() {
        var URL = window.location.href.split('/');
        var val = document.getElementById("Language").value;
        URL[3] = val;
        window.location.assign(URL.join('/'));
      }
    </script>
</head>
<body>
<div id="top-bar">
<a id="home" href="/">Visu<span class="colour">Algo</span><span style="font-size: 40%">.net</span></a>
/
<select id="Language" onchange="changeURL()">
<option value="zh" selected>zh</option>
</select>
/fenwicktree
<span id="title">
<a id='point-update-range-query' class='selected-viz'>Fenwick Tree (Point Update Range Query)</a>
<a id='range-update-point-query'>(RU PQ)</a>
<a id='range-update-range-query'>(RU RQ)</a>
</span>
<div id="mode-menu">
<div id='mode-button' title='exploration'>示例模式 &#9663;</div>
<div id='other-modes'>
<a title='e-Lecture'>电子讲座模式</a>
</div>
</div>
</div>
<div id="dark-overlay"></div>
<div id="status" class="panel"><p></p></div>
<div id="status-hide" class="panel-hide"><img src="../img/arrow_white_right.png" alt=">" title="show/hide status panel" /></div>
<div id="codetrace" class="panel">
<p id="code1" style="padding-top: 10px;"></p>
<p id="code2"></p>
<p id="code3"></p>
<p id="code4"></p>
<p id="code5"></p>
<p id="code6"></p>
<p id="code7" style="padding-bottom: 10px;"></p>
</div>
<div id="codetrace-hide" class="panel-hide"><img src="../img/arrow_white_right.png" alt=">" title="show/hide codetrace panel" /></div>
<div id="left-bar"></div>
<div id="right-bar"></div>
<div id="media-controls">
<div id='speed-control'>减速<div id='speed-input'></div>加速</div>
<span id="go-to-beginning" class="media-control-button" title="go to beginning" onclick=goToBeginning()><img src="../img/goToBeginning.png" alt="go to beginning"></span>
<span id="previous" class="media-control-button" title="step backward" onclick=stepBackward()><img src="../img/prevFrame.png" alt="previous frame"></span>
<span id="pause" class="media-control-button" title="pause" onclick=pause()><img src="../img/pause.png" alt="pause"></span>
<span id="play" class="media-control-button" title="play" onclick=play()><img src="../img/play.png" alt="play"></span>
<span id="next" class="media-control-button" title="step forward" onclick=stepForward()><img src="../img/nextFrame.png" alt="next frame"></span>
<span id="go-to-end" class="media-control-button" title="go to end" onclick=goToEnd()><img src="../img/goToEnd.png" alt="go to end"></span>
<div id="progress-bar" class="media-control-button"></div>
</div>
<div id='viz'></div>
<div id='current-action' class='panel'></div>
<div id='e-lecture' class='panel'></div>
<div id="overlay" hidden></div>
<div id="dropdown-temp-holder" hidden></div>
<div id="electure-1" class="electure-dialog" style="top:60px;left:60px;width:500px;">
<p>A Binary Indexed (Fenwick) Tree is a data structure that provides efficient methods for implementing <b>dynamic cumulative frequency tables</b> (described in the next slide).</p><br><p>In this visualization, we will refer to this data structure using the term Fenwick Tree as the abbreviation &#39;BIT&#39; of Binary Indexed Tree is usually associated with bit manipulation.</p>
<hr>
<p><b>Remarks</b>: By default, we show e-Lecture Mode for first time (or non logged-in) visitor.<br>
Please <a href="login"><u>login</u></a> if you are a repeated visitor or <a href="login"><u>register</u></a> for an (optional) free account first.</p>
<div id='electure-dropdown'>
<select class="lecture-dropdown" style="width:100%">
<option value="1">1. Binary Indexed (Fenwick) Tree</option>
<option value="1-1">&nbsp;&nbsp;&nbsp;1-1. Cumulative Frequency Table</option>
<option value="1-2">&nbsp;&nbsp;&nbsp;1-2. Range Sum Query: rsq(i, j)</option>
<option value="1-3">&nbsp;&nbsp;&nbsp;1-3. Dynamic Cumulative Frequency Table</option>
<option value="2">2. Modes and the First/Default Mode</option>
<option value="3">3. Point Update Range Query (PU RQ)</option>
<option value="3-1">&nbsp;&nbsp;&nbsp;3-1. The Visualization - Part 1</option>
<option value="3-2">&nbsp;&nbsp;&nbsp;3-2. The Visualization - Part 2</option>
<option value="3-3">&nbsp;&nbsp;&nbsp;3-3. The Visualization - Part 3</option>
<option value="3-4">&nbsp;&nbsp;&nbsp;3-4. Range Query: rsq(j)</option>
<option value="3-5">&nbsp;&nbsp;&nbsp;3-5. Range Query: rsq(i, j)</option>
<option value="3-6">&nbsp;&nbsp;&nbsp;3-6. Point Update: update(i, v)</option>
<option value="4">4. Second Mode</option>
<option value="5">5. Range Update Point Query (RU PQ)</option>
<option value="5-1">&nbsp;&nbsp;&nbsp;5-1. The RU PQ Visualization</option>
<option value="6">6. Third Mode</option>
<option value="7">7. Range Update Range Query (RU RQ)</option>
<option value="7-1">&nbsp;&nbsp;&nbsp;7-1. The RU RQ Visualization</option>
<option value="8">8. Extras</option>
<option value="8-1">&nbsp;&nbsp;&nbsp;8-1. Implementation</option>
<option value="99">99. 状态面板</option>
<option value="99-1">&nbsp;&nbsp;&nbsp;99-1. 代码追踪面板</option>
<option value="99-2">&nbsp;&nbsp;&nbsp;99-2. 媒体控制</option>
<option value="99-3">&nbsp;&nbsp;&nbsp;99-3. 返回 ”探索模式“</option>
</select>
</div>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-next' data-nextid="1-1">下一个 <u>PgDn</u></div>
</div>
<div id="electure-1-1" class="electure-dialog" style="top:60px;left:60px;width:500px;">
<p>Suppose that we have a <i>multiset</i> of <i>integers</i> <b>s = {2,4,5,6,5,6,8,6,7,9,7}</b> (not necessarily sorted). There are <b>m = 11</b> elements in <b>s</b>. Also suppose that the largest integer that we will ever use is <b>n = 10</b> and we never use integer 0. For example, these integers represent student (integer) scores from [1..10]. Notice that <b>m</b> is independent of <b>n</b>.</p><br><p>We can create a frequency table <b>f</b> from <b>s</b> with a trivial <b>O(m)</b> time loop. We can then create cumulative frequency table <b>cf</b> from frequency table <b>f</b> in <b>O(n)</b> time using technique similar to DP 1D prefix sum.</p><br><table border="1"><tbody><tr><th>Index/Score/Symbol</th><th>Frequency <b>f</b></th><th>Cumulative Frequency <b>cf</b></th></tr><tr><td>0</td><td>-</td><td>- (index 0 is ignored)</td></tr><tr><td>1</td><td>0</td><td>0</td></tr><tr><td>2</td><td>1</td><td>1</td></tr><tr><td>3</td><td>0</td><td>1</td></tr><tr><td>4</td><td>1</td><td>2</td></tr><tr><td>5</td><td>2</td><td>4 == <b>cf[4]+f[5]</b></td></tr><tr><td>6</td><td>3</td><td>7 == <b>cf[5]+f[6]</b></td></tr><tr><td>7</td><td>2</td><td>9</td></tr><tr><td>8</td><td>1</td><td>10</td></tr><tr><td>9</td><td>1</td><td>11</td></tr><tr><td>10 == <b>n</b></td><td>0</td><td>11 == <b>m</b></td></tr></tbody></table>
<hr>
<p>Pro-tip: Since you are not <a href="login"><u>logged-in</u></a>, you may be a first time visitor who are not aware of the following keyboard shortcuts to navigate this e-Lecture mode: <b>[PageDown]</b> to advance to the next slide, <b>[PageUp]</b> to go back to the previous slide, <b>[Esc]</b> to toggle between this e-Lecture mode and exploration mode.</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="1">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="1-2">下一个 <u>PgDn</u></div>
</div>
<div id="electure-1-2" class="electure-dialog" style="top:60px;left:60px;width:500px;">
<p>With such cumulative frequency table <b>cf</b>, we can perform <b>Range Sum Query: rsq(i, j)</b> to return the sum of frequencies between index <b>i</b> and <b>j</b> (inclusive), in efficient <b>O(1)</b> time, again using the DP 1D prefix sum (i.e. the inclusion-exclusion principle). For example, <b>rsq(5, 9) = rsq(1, 9) - rsq(1, 4) = 11-2 = 9</b>.</p><br><table border="1"><tbody><tr><th>Index/Score/Symbol</th><th>Frequency <b>f</b></th><th>Cumulative Frequency <b>cf</b></th></tr><tr><td>0</td><td>-</td><td>- (index 0 is ignored)</td></tr><tr><td>1</td><td>0</td><td>0</td></tr><tr><td>2</td><td>1</td><td>1</td></tr><tr><td>3</td><td>0</td><td>1</td></tr><tr><td>4</td><td>1</td><td>2 == <b>rsq(1, 4)</b></td></tr><tr><td>5</td><td>2</td><td>4</td></tr><tr><td>6</td><td>3</td><td>7</b></td></tr><tr><td>7</td><td>2</td><td>9</td></tr><tr><td>8</td><td>1</td><td>10</td></tr><tr><td>9</td><td>1</td><td>11 == <b>rsq(1, 9)</b></td></tr><tr><td>10 == <b>n</b></td><td>0</td><td>11 == <b>m</b></td></tr></tbody></table>
<hr>
<p>Another pro-tip: We designed this visualization and this e-Lecture mode to look good on 1366x768 resolution <b>or larger</b> (typical modern laptop resolution in 2017). We recommend using Google Chrome to access VisuAlgo. Go to full screen mode (<b>F11</b>) to enjoy this setup. However, you can use zoom-in (<b>Ctrl +</b>) or zoom-out (<b>Ctrl -</b>) to calibrate this.</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="1-1">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="1-3">下一个 <u>PgDn</u></div>
</div>
<div id="electure-1-3" class="electure-dialog" style="top:60px;left:60px;width:500px;">
<p>A dynamic data structure need to support (frequent) updates in between queries. For example, we may update (add) the frequency of score <b>7</b> from 2 &rightarrow; 5 and update (subtract) the frequency of score <b>9</b> from 1 &rightarrow; 0, thereby updating the table into:</p><br><table border="1"><tbody><tr><th>Index/Score/Symbol</th><th>Frequency <b>f</b></th><th>Cumulative Frequency <b>cf</b></th></tr><tr><td>0</td><td>-</td><td>- (index 0 is ignored)</td></tr><tr><td>1</td><td>0</td><td>0</td></tr><tr><td>2</td><td>1</td><td>1</td></tr><tr><td>3</td><td>0</td><td>1</td></tr><tr><td>4</td><td>1</td><td>2</td></tr><tr><td>5</td><td>2</td><td>4</b></td></tr><tr><td>6</td><td>3</td><td>7</b></td></tr><tr><td>7</td><td>2 &rightarrow; 5</td><td>9 &rightarrow; 12</td></tr><tr><td>8</td><td>1</td><td>10 &rightarrow; 13</td></tr><tr><td>9</td><td>1 &rightarrow; 0</td><td>11 &rightarrow; 13</td></tr><tr><td>10 == <b>n</b></td><td>0</td><td>11 &rightarrow; 13 == <b>m</b></td></tr></tbody></table><br><p>A pure array based data structure will need <b>O(n)</b> per update operation. Can we do better?</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="1-2">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="2">下一个 <u>PgDn</u></div>
</div>
<div id="electure-2" class="electure-dialog" style="top:60px;left:230px;width:500px;">
<p>Introducing: Fenwick Tree data structure.</p><br><p>There are three mode of usages of Fenwick Tree in this visualization.</p><br><p>The first mode is the default Fenwick Tree that can handle both <b>Point Update (PU)</b> and <b>Range Query (RQ)</b> in O(log <b>n</b>) where <b>n</b> is the largest index/key in the data structure. Remember that the actual number of keys in the data structure is denoted by another variable <b>m</b>. We abbreviate this default type as <b>PU RQ</b> that simply stands for <b>Point Update Range Query</b>.</p><br><p>This clever arrangement of integer keys idea is the one that originally appears in Peter M. Fenwick&#39;s 1994 paper.</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="1-3">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="3">下一个 <u>PgDn</u></div>
</div>
<div id="electure-3" class="electure-dialog" style="bottom:160px;left:60px;width:500px;">
<p>You can click the &#39;<b>Create</b>&#39; menu to create a frequency array <b>f</b> where <b>f[i]</b> denotes the frequency of appearance of key <b>i</b> in our original array of keys <b>s</b>.</p><br><p>IMPORTANT: This frequency array <b>f</b> is not the original array of keys <b>s</b>. For example, if you enter {0,1,0,1,2,3,2,1,1,0}, it means that you are creating 0 one, 1 two, 0 three, 1 four, ..., 0 ten (1-based indexing). The largest index/integer key is <b>n = 10</b> in this example as in the earlier slides.</p><br><p>If you have the original array <b>s</b> of <b>m</b> elements, e.g. {2,4,5,6,5,6,8,6,7,9,7} from earlier slides (<b>s</b> does not need to be necessarily sorted), you can do an O(<b>m</b>) pass to convert <b>s</b> into frequency table <b>f</b> of <b>n</b> indices/integer keys. (<i>We will provide this alternative input method in the near future</i>).</p><br><p>You can click the &#39;<b>Randomize</b>&#39; button to generate random frequencies.</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="2">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="3-1">下一个 <u>PgDn</u></div>
</div>
<div id="electure-3-1" class="electure-dialog" style="top:260px;left:50%;margin-left:-250px;width:500px;">
<p>Although conceptually this data structure is a <b>tree</b>, it will be implemented as an integer <b>array</b> called <b>ft</b> that ranges from index 1 to index <b>n</b> (we sacrifice index 0 of our <b>ft</b> array) The values inside the vertices of the Fenwick Tree shown above are the values stored in the 1-based Fenwick Tree <b>ft</b> array.</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="3">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="3-2">下一个 <u>PgDn</u></div>
</div>
<div id="electure-3-2" class="electure-dialog" style="top:500px;left:50%;margin-left:-250px;width:500px;">
<p>The values inside the vertices at the bottom are the values of the data (the frequency array <b>f</b>).</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="3-1">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="3-3">下一个 <u>PgDn</u></div>
</div>
<div id="electure-3-3" class="electure-dialog" style="top:270px;left:50%;margin-left:-250px;width:500px;">
<p>The value stored in index <b>i</b> in array <b>ft</b>, i.e. <b>ft[i]</b> is the cumulative frequency of keys in range <b>[i-LSOne(i)+1 .. i]</b>. Visually, this range is shown by the edges of the Fenwick Tree. For details of <b>LSOne(i)</b> operation, see <a href="./bitmask"><u>our bitmask visualization page</u></a>.</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="3-2">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="3-4">下一个 <u>PgDn</u></div>
</div>
<div id="electure-3-4" class="electure-dialog" style="bottom:160px;left:60px;width:500px;">
<p>The function <b>rsq(j)</b> returns the cumulative frequencies from the first index 1 (ignoring index 0) to index <b>j</b>.</p><br><p>This value is the sum of sub-frequencies stored in array <b>ft</b> with indices related to <b>j</b> via this formula <b>j&#39; = j-LSOne(j)</b>. This relationship forms a Fenwick Tree, specifically, the &#39;interrogation tree&#39; of Fenwick Tree.</p><br><p>We apply this formula iteratively until <b>j</b> is 0. <i>(We will add that dummy vertex 0 later)</i>.</p><br><p>Discussion: Do you understand what does this function compute?</p><br><p>This function runs is O(log <b>n</b>), regardless of <b>m</b>. Discussion: Why?</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="3-3">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="3-5">下一个 <u>PgDn</u></div>
</div>
<div id="electure-3-5" class="electure-dialog" style="bottom:160px;left:60px;width:500px;">
<p><b>rsq(i, j)</b> returns the cumulative frequencies from index <b>i</b> to <b>j</b>, inclusive.</p><br><p>If <b>i = 1</b>, the previous slide is sufficient.<br>If <b>i > 1</b>, we simply need to return: <b>rsq(j)–rsq(i–1)</b>.</p><br><p>Discussion: Do you understand the reason?</p><br><p>This function also runs in O(log <b>n</b>), regardless of <b>m</b>. Discussion: Why?</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="3-4">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="3-6">下一个 <u>PgDn</u></div>
</div>
<div id="electure-3-6" class="electure-dialog" style="bottom:160px;left:60px;width:500px;">
<p>To update the frequency of a key (an index) <b>i</b> by <b>v</b> (<b>v</b> is either positive or negative; <b>|v|</b> does not necessarily be one), we use <b>update(i, v)</b>.</p><br><p>Indices that are related to <b>i</b> via <b>i&#39; = i+LSOne(i)</b> will be updated by <b>v</b> when <b>i</b> &lt; <b>ft.size()</b> (Note that <b>ft.size()</b> is <b>N+1</b> (as we ignore index 0). These relationships form a variant of Fenwick Tree structure called the &#39;updating tree&#39;.</p><br><p>Discussion: Do you understand this operation and on why we avoided index 0?</p><br><p>This function also runs in O(log <b>n</b>), regardless of <b>m</b>. Discussion: Why?</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="3-5">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="4">下一个 <u>PgDn</u></div>
</div>
<div id="electure-4" class="electure-dialog" style="top:60px;left:400px;width:500px;">
<p>The second mode of Fenwick Tree is the one that can handle <b>Range Update (RU)</b> but only able to handle <b>Point Query (PQ)</b> in O(log <b>n</b>).</p><br><p>We abbreviate this type as <b>RU PQ</b>.</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="3-6">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="5">下一个 <u>PgDn</u></div>
</div>
<div id="electure-5" class="electure-dialog" style="bottom:160px;left:60px;width:500px;">
<p>Create the data and try running the <b>Range Update</b> or <b>Point Query</b> algorithms on it. Creating the data for this type means inserting several intervals. For example, if you enter [2,4],[3,5], it means that we are updating range 2 to 4 by +1 and then updating range 3 to 5 by +1, thus we have the following frequency table: 0,1,2,2,1 that means 0 one, 1 two, 2 threes, 2 fours, 1 five.</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="4">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="5-1">下一个 <u>PgDn</u></div>
</div>
<div id="electure-5-1" class="electure-dialog" style="top:180px;left:50%;margin-left:-250px;width:500px;">
<p>The vertices at the top shows the values stored in the Fenwick Tree (the <b>ft</b> array).</p><br><p>The vertices at the bottom shows the values of the data (the frequency table <b>f</b>).</p><br><p>Notice the clever modification of Fenwick Tree used in this RU PQ type: We increase the start of the range by +1 but decrease one index after the end of the range by -1 to achieve this result.</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="5">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="6">下一个 <u>PgDn</u></div>
</div>
<div id="electure-6" class="electure-dialog" style="top:60px;left:500px;width:500px;">
<p>The third mode of Fenwick Tree is the one that can handle both <b>Range Update (RU)</b> and <b>Range Query (RQ)</b> in O(log <b>n</b>), making this type on par with <b><a href="./segmenttree">Segment Tree with Lazy Update</a></b> that can also do RU RQ in O(log <b>n</b>).</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="5-1">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="7">下一个 <u>PgDn</u></div>
</div>
<div id="electure-7" class="electure-dialog" style="bottom:225px;left:60px;width:350px;">
<p>Create the data and try running the <b>Range Update</b> or <b>Range Query</b> algorithms on it.</p><br><p>Creating the data is inserting several intervals, similar as RU PQ version. But this time, you can also do Range Query efficiently.</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="6">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="7-1">下一个 <u>PgDn</u></div>
</div>
<div id="electure-7-1" class="electure-dialog" style="top:180px;left:50%;margin-left:-250px;width:500px;">
<p>In Range Update Range Query Fenwick Tree, we need to have two Fenwick Trees. The vertices at the top shows the values of the first Fenwick Tree (BIT1[] array), the vertices at the middle shows the values of the second Fenwick Tree (BIT2[] array), while the vertices at the bottom shows the values of the data (the frequency table). The first Fenwick Tree behaves the same as in RU PQ version. The second Fenwick Tree is used to do clever offset to allow Range Query again.</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="7">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="8">下一个 <u>PgDn</u></div>
</div>
<div id="electure-8" class="electure-dialog" style="top:60px;left:60px;width:500px;">
<p>We have a few more extra stuffs involving this data structure.</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="7-1">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="8-1">下一个 <u>PgDn</u></div>
</div>
<div id="electure-8-1" class="electure-dialog" style="top:60px;left:60px;width:500px;">
<p>Unfortunately, this data structure is not yet available in C++ STL, Java API, Python or OCaml Standard Library as of 2020. Therefore, we have to write our own implementation.</p><br><p>Please look at the following C++/Java/Python/OCaml implementations of this Fenwick Tree data structure in Object-Oriented Programming (OOP) fashion:<br><a href="https://github.com/stevenhalim/cpbook-code/blob/master/ch2/ourown/fenwicktree_ds.cpp" target="_blank"><u>fenwicktree_ds.cpp</u></a><br><a href="https://github.com/stevenhalim/cpbook-code/blob/master/ch2/ourown/fenwicktree_ds.java" target="_blank"><u>fenwicktree_ds.java</u></a><br><a href="https://github.com/stevenhalim/cpbook-code/blob/master/ch2/ourown/fenwicktree_ds.py" target="_blank"><u>fenwicktree_ds.py</u></a><br><a href="https://github.com/stevenhalim/cpbook-code/blob/master/ch2/ourown/fenwicktree_ds.ml" target="_blank"><u>fenwicktree_ds.ml</u></a><br></p><br><p>Again, you are free to customize this custom library implementation to suit your needs.</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="8">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="99">下一个 <u>PgDn</u></div>
</div>
<div id="electure-99" class="electure-dialog" style="right:150px;bottom:335px;width:500px;">
当操作进行时，状态面板将会有每个步骤的描述。
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="8-1">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="99-1">下一个 <u>PgDn</u></div>
</div>
<div id="electure-99-1" class="electure-dialog" style="right:170px;bottom:275px;width:180px;">
<div style="background-color: white; color: black;">
<p>e-Lecture: The content of this slide is hidden and only available for legitimate CS lecturer worldwide. Drop an email to visualgo.info at gmail dot com if you want to activate this CS lecturer-only feature <b>and you are really a CS lecturer (show your University staff profile)</b>.</p>
</div>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="99">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="99-2">下一个 <u>PgDn</u></div>
</div>
<div id="electure-99-2" class="electure-dialog" style="bottom:70px;left:50%;margin-left:-120px;width:260px;">
使用用户控件控制动画！可用的快捷键有：<div>空格键：绘制／停止／重绘</div><div>左／右箭头：上一步／下一步</div><div>-／+：减缓／增加速度</div><div><br></div>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="99-1">上一个 <u>PgUp</u></div>
<div class='electure-next' data-nextid="99-3">下一个 <u>PgDn</u></div>
</div>
<div id="electure-99-3" class="electure-dialog" style="top:70px;right:60px;width:300px;">
<p>Return to &#39;Exploration Mode&#39; to start exploring!</p><br><p>Note that if you notice any bug in this visualization or if you want to request for a new visualization feature, do not hesitate to drop an email to the project leader: Dr Steven Halim via his email address: stevenhalim at gmail dot com.</p>
<div class='electure-end'>X <u>Esc</u></div>
<div class='electure-prev' data-nextid="99-2">上一个 <u>PgUp</u></div>
</div>
<div id="popup" hidden>
<div id="popup-content"></div>
<span id="hide-popup" hidden>X <u>关闭</u></span>
</div>
<div id="actions" class="panel">
<p id="create" class="execAction">创建</p>
<p id="query" class="execAction">RSQ / Query</p>
<p id="update" class="execAction">更新</p>
</div>
<div id="actions-hide" class="panel-hide"><img src="../img/arrow_white_right.png" alt=">" title="show/hide actions panel" /></div>
<div id="actions-extras">
<div class="point-update-range-query-actions">
<div class="create action-menu-pullout">
<div id="create-input" class="new-menu-option"><input type="text" id="create-input-data" title="Enter the data separated by comma" autocomplete="off" value=1 /></div>
<div id="create-go" class="execAction coloured-menu-option" onclick=create() title="Create"><p>执行</p></div>
<div id="create-randomize" class="execAction coloured-menu-option" onclick=randomize() title="Randomize"><p>Randomize</p></div>
<div id="create-err" class="err"></div>
</div>
<div class="update action-menu-pullout">
<div class="new-menu-option coloured-menu-option"><p>pos = </p></div>
<div id="update-input" class="new-menu-option"><input type="text" id="update-input-point" title="Enter the position" autocomplete="off" value=2 /></div>
<div class="new-menu-option coloured-menu-option"><p>val += </p></div>
<div id="update-input" class="new-menu-option"><input type="text" id="update-input-value" title="Enter the increment value" autocomplete="off" value=3 /></div>
<div id="update-go" class="execAction coloured-menu-option" onclick=updatePoint() title="Update"><p>执行</p></div>
<div id="update-err" class="err"></div>
</div>
<div class="query action-menu-pullout">
<div class="new-menu-option coloured-menu-option"><p>L = </p></div>
<div id="query-input" class="new-menu-option"><input type="text" id="query-input-left" title="Enter the left position" autocomplete="off" value=3 /></div>
<div class="new-menu-option coloured-menu-option"><p>R = </p></div>
<div id="query-input" class="new-menu-option"><input type="text" id="query-input-right" title="Enter the right position" autocomplete="off" value=1 /></div>
<div id="query-go" class="execAction coloured-menu-option" onclick=sumRange() title="Query"><p>执行</p></div>
<div id="query-err" class="err"></div>
</div>
</div>
<div class="range-update-point-query-actions">
<div class="create action-menu-pullout">
<div id="create-input" class="new-menu-option"><input type="text" id="create-input-data" title="Enter the data separated by comma" autocomplete="off" value=1 /></div>
<div id="create-go" class="execAction coloured-menu-option" onclick=create() title="Create"><p>执行</p></div>
<div id="create-randomize" class="execAction coloured-menu-option" onclick=randomize() title="Randomize"><p>Randomize</p></div>
<div id="create-err" class="err"></div>
</div>
<div class="update action-menu-pullout">
<div class="new-menu-option coloured-menu-option"><p>L = </p></div>
<div id="update-input" class="new-menu-option"><input type="text" id="update-input-left" title="Enter the position" autocomplete="off" value=1 /></div>
<div class="new-menu-option coloured-menu-option"><p>R = </p></div>
<div id="update-input" class="new-menu-option"><input type="text" id="update-input-right" title="Enter the position" autocomplete="off" value=1 /></div>
<div class="new-menu-option coloured-menu-option"><p>val += </p></div>
<div id="update-input" class="new-menu-option"><input type="text" id="update-input-value" title="Enter the increment value" autocomplete="off" value=1 /></div>
<div id="update-go" class="execAction coloured-menu-option" onclick=updateRange() title="Update"><p>执行</p></div>
<div id="update-err" class="err"></div>
</div>
<div class="query action-menu-pullout">
<div class="new-menu-option coloured-menu-option"><p>pos = </p></div>
<div id="query-input" class="new-menu-option"><input type="text" id="query-input-point" title="Enter the right position" autocomplete="off" value=1 /></div>
<div id="query-go" class="execAction coloured-menu-option" onclick=sumPoint() title="Query"><p>执行</p></div>
<div id="query-err" class="err"></div>
</div>
</div>
<div class="range-update-range-query-actions">
<div class="create action-menu-pullout">
<div id="create-input" class="new-menu-option"><input type="text" id="create-input-data" title="Enter the data separated by comma" autocomplete="off" value=1 /></div>
<div id="create-go" class="execAction coloured-menu-option" onclick=create() title="Create"><p>执行</p></div>
<div id="create-randomize" class="execAction coloured-menu-option" onclick=randomize() title="Randomize"><p>Randomize</p></div>
<div id="create-err" class="err"></div>
</div>
<div class="update action-menu-pullout">
<div class="new-menu-option coloured-menu-option"><p>L = </p></div>
<div id="update-input" class="new-menu-option"><input type="text" id="update-input-left" title="Enter the position" autocomplete="off" value=1 /></div>
<div class="new-menu-option coloured-menu-option"><p>R = </p></div>
<div id="update-input" class="new-menu-option"><input type="text" id="update-input-right" title="Enter the position" autocomplete="off" value=1 /></div>
<div class="new-menu-option coloured-menu-option"><p>val += </p></div>
<div id="update-input" class="new-menu-option"><input type="text" id="update-input-value" title="Enter the increment value" autocomplete="off" value=1 /></div>
<div id="update-go" class="execAction coloured-menu-option" onclick=updateRangeV2() title="Update"><p>执行</p></div>
<div id="update-err" class="err"></div>
</div>
<div class="query action-menu-pullout">
<div class="new-menu-option coloured-menu-option"><p>L = </p></div>
<div id="query-input" class="new-menu-option"><input type="text" id="query-input-left" title="Enter the left position" autocomplete="off" value=1 /></div>
<div class="new-menu-option coloured-menu-option"><p>R = </p></div>
<div id="query-input" class="new-menu-option"><input type="text" id="query-input-right" title="Enter the right position" autocomplete="off" value=1 /></div>
<div id="query-go" class="execAction coloured-menu-option" onclick=sumRangeV2() title="Query"><p>执行</p></div>
<div id="query-err" class="err"></div>
</div>
</div>
</div>
<div id="bottom-bar">
<a id="trigger-about">关于</a>
</div>
<div id="about" class="overlays">
<h4>关于</h4><span class='close-overlay'>&#x2715;</span>
<div class='content'>
VisuAlgo在2011年由Steven Halim博士概念化，作为一个工具，帮助他的学生更好地理解数据结构和算法，让他们自己和自己的步伐学习基础。<br>VisuAlgo包含许多高级算法，这些算法在Steven Halim博士的书（“竞争规划”，与他的兄弟Felix Halim博士合作）和其他书中讨论。今天，一些高级算法的可视化/动画只能在VisuAlgo中找到。<br>虽然专门为新加坡国立大学（NUS）学生采取各种数据结构和算法类（例如CS1010，CS1020，CS2010，CS2020，CS3230和CS3230），作为在线学习的倡导者，我们希望世界各地的好奇心发现这些可视化也很有用。<br>VisuAlgo不是从一开始就设计为在小触摸屏（例如智能手机）上工作良好，因为需要满足许多复杂的算法可视化，需要大量的像素和点击并拖动手势进行交互。一个令人尊敬的用户体验的最低屏幕分辨率为1024x768，并且只有着陆页相对适合移动设备。<br>VisuAlgo是一个正在进行的项目，更复杂的可视化仍在开发中。<br>最令人兴奋的发展是自动问题生成器和验证器（在线测验系统），允许学生测试他们的基本数据结构和算法的知识。这些问题是通过一些规则随机生成的，学生的答案会在提交给我们的评分服务器后立即自动分级。这个在线测验系统，当它被更多的世界各地的CS教师采用，应该技术上消除许多大学的典型计算机科学考试手动基本数据结构和算法问题。通过在通过在线测验时设置小（但非零）的重量，CS教练可以（显着地）增加他/她的学生掌握这些基本问题，因为学生具有几乎无限数量的可以立即被验证的训练问题他们参加在线测验。培训模式目前包含12个可视化模块的问题。我们将很快添加剩余的8个可视化模块，以便VisuAlgo中的每个可视化模块都有在线测验组件。<br>另一个积极的发展分支是VisuAlgo的国际化子项目。我们要为VisuAlgo系统中出现的所有英语文本准备一个CS术语的数据库。这是一个很大的任务，需要众包。一旦系统准备就绪，我们将邀请VisuAlgo游客贡献，特别是如果你不是英语母语者。目前，我们还以各种语言写了有关VisuAlgo的公共注释：<br>
<a href="https://weibo.com/p/230418436e9ee80102v4rk" target='_blank'><u>zh</u></a>, <a href='https://www.facebook.com/notes/steven-halim/httpidvisualgonet-visualisasi-struktur-data-dan-algoritma-dengan-animasi/10153236934439689' target='_blank'><u>id</u></a>, <a href="https://blog.naver.com/visualgo_nus" target='_blank'><u>kr</u></a>, <a href='https://www.facebook.com/groups/163215593699283/permalink/824003417620494/' target='_blank'><u>vn</u></a>, <a href='http://pantip.com/topic/32736343' target='_blank'><u>th</u></a>.</p>
</div>
</div>

<script src="../js/jquery-3.3.1.min.js"></script>
<script>
      var PHP_DOMAIN = "";

      // surprise colour!
      // Referenced to in  home.js and viz.js also
      var colourArray = ["#52bc69", "#d65775"/*"#ed5a7d"*/, "#2ebbd1", "#d9513c", "#fec515", "#4b65ba", "#ff8a27", "#a7d41e"]; // green, pink, blue, red, yellow, indigo, orange, lime

      function disableScroll() { $('html').css('overflow', 'hidden'); }

      function enableScroll() { $('html').css('overflow', 'visible'); }

      function replaceAll(find, replace, str) { return str.replace(new RegExp(find, 'g'), replace); }

      function getColours() {
        var generatedColours = new Array();
        while (generatedColours.length < 4) {
          var n = (Math.floor(Math.random() * colourArray.length));
          if ($.inArray(n, generatedColours) == -1)
            generatedColours.push(n);
        }
        return generatedColours;
      }

      function isOn(value, position) {
        return (value>>position) & 1 === 1;
      }

      function customAlert(msg) {
        $('#custom-alert p').html(msg);
        var m = -1 * ($('#custom-alert').outerHeight()/2);
        $('#custom-alert').css('margin-top', m+'px');
        $('#dark-overlay').fadeIn(function() {
          $('#custom-alert').fadeIn(function() {
            setTimeout(function() {
              $('#custom-alert').fadeOut(function() {
                $('#dark-overlay').fadeOut();
              });
            }, 1000);
          });
        });
      }

      function showLoadingScreen() {
        $('#loading-overlay').show();
        $('#loading-message').show();
      }

      function hideLoadingScreen() {
        $('#loading-overlay').hide();
      }

      function commonAction(retval, msg) {
        //setTimeout(function() {
          if (retval) { // mode == "exploration" && // now not only for exploration mode, but check if this opens other problems
            $('#current-action').show();
            $('#current-action').html(mode == "exploration" ? msg : ("e-Lecture Example (auto play until done)<br>" + msg));
            $('#progress-bar').slider("option", "max", gw.getTotalIteration()-1);
            triggerRightPanels();
            isPlaying = true;
          }
        //}, 500);
      }

      function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split('&');
        for (var i = 0; i < vars.length; i++) {
          var pair = vars[i].split('=');
          if (decodeURIComponent(pair[0]) == variable)
            return decodeURIComponent(pair[1]);
        }
        return "";
      }

      var generatedColours = getColours();
      var surpriseColour = colourArray[generatedColours[0]];
      var colourTheSecond = colourArray[generatedColours[1]];
      var colourTheThird = colourArray[generatedColours[2]];
      var colourTheFourth = colourArray[generatedColours[3]];

      $(function() {
        $('.links').css('background', surpriseColour);
        $('.right-links').css('background', surpriseColour);
        $('#login-go').css('background', surpriseColour);

        $('.colour').css("color", surpriseColour); // name
        $('h4').css("background-color", surpriseColour); // about, contact us etc. button background

        // title
        $('#title a').click(function() {
          $('#title a').removeClass('selected-viz');
          $(this).addClass('selected-viz');
          // temporary quick fix for Google Chrome Aug 2016 issue...
          setTimeout(function(){ document.body.style.zoom = "100.1%"; }, 100); // force resize/redraw...
          setTimeout(function(){ document.body.style.zoom = "100%"; }, 600);
        });

        // overlays stuffs
        $('#trigger-about').click(function() {
          if ($(window).width() > 600) {
            $('#dark-overlay').fadeIn(function() {
              $('#about').fadeIn();
            });
          }
          else
            alert('Sorry, this dialog is too big. Please load it on bigger screen');
        });

        $('.close-overlay').click(function() {
          $('.overlays').fadeOut(function() {
            $('#dark-overlay').fadeOut();
          });
        });

        $('#dark-overlay').click(function() {
          $('.overlays').fadeOut();
          $('#dark-overlay').fadeOut();
        });
      });
    </script>

<script src="../js/jquery-ui.min.js"></script>
<script src="../js/d3.min.js"></script>
<script src="../js/viz-1.0.3.js"></script>
<script src="../js/visualgo_print.js"></script>
<script src="../js/graph_library.js"></script>
<script>
      function runSlide(slide) {
        if (slide == '1') {
          $("#e-lecture").html("slide " + slide + " (" + 4 + "%)");
          
          hideEntireActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '1-1') {
          $("#e-lecture").html("slide " + slide + " (" + 8 + "%)");
          
          hideEntireActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '1-2') {
          $("#e-lecture").html("slide " + slide + " (" + 12 + "%)");
          
          hideEntireActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '1-3') {
          $("#e-lecture").html("slide " + slide + " (" + 16 + "%)");
          
          hideEntireActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '2') {
          $("#e-lecture").html("slide " + slide + " (" + 20 + "%)");
          
          hideEntireActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '3') {
          $("#e-lecture").html("slide " + slide + " (" + 25 + "%)");
          $('#point-update-range-query').click();
$("#create").click().addClass("menu-highlighted");
BITWidget.resize(10);
BITWidget.fill();
BITWidget.sumPoint(10);

          showActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '3-1') {
          $("#e-lecture").html("slide " + slide + " (" + 29 + "%)");
          
          showActionsPanel();
 
          showStatusPanel();
          showCodetracePanel();
      
        }
        if (slide == '3-2') {
          $("#e-lecture").html("slide " + slide + " (" + 33 + "%)");
          
          showActionsPanel();
 
          showStatusPanel();
          showCodetracePanel();
      
        }
        if (slide == '3-3') {
          $("#e-lecture").html("slide " + slide + " (" + 37 + "%)");
          
          showActionsPanel();
 
          showStatusPanel();
          showCodetracePanel();
      
        }
        if (slide == '3-4') {
          $("#e-lecture").html("slide " + slide + " (" + 41 + "%)");
          $("#query").click().addClass("menu-highlighted");
BITWidget.sumPoint(6);
          showActionsPanel();
 
          showStatusPanel();
          showCodetracePanel();
      
        }
        if (slide == '3-5') {
          $("#e-lecture").html("slide " + slide + " (" + 45 + "%)");
          $("#query").click().addClass("menu-highlighted");

          showActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '3-6') {
          $("#e-lecture").html("slide " + slide + " (" + 50 + "%)");
          $("#update").click().addClass("menu-highlighted");
BITWidget.updatePoint(1, 7);
          showActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '4') {
          $("#e-lecture").html("slide " + slide + " (" + 54 + "%)");
          $('#range-update-point-query').click();
          hideEntireActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '5') {
          $("#e-lecture").html("slide " + slide + " (" + 58 + "%)");
          $('#range-update-point-query').click();
          showActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '5-1') {
          $("#e-lecture").html("slide " + slide + " (" + 62 + "%)");
          
          showActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '6') {
          $("#e-lecture").html("slide " + slide + " (" + 66 + "%)");
          $('#range-update-range-query').click();
          hideEntireActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '7') {
          $("#e-lecture").html("slide " + slide + " (" + 70 + "%)");
          
          showActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '7-1') {
          $("#e-lecture").html("slide " + slide + " (" + 75 + "%)");
          
          showActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '8') {
          $("#e-lecture").html("slide " + slide + " (" + 79 + "%)");
          
          hideEntireActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '8-1') {
          $("#e-lecture").html("slide " + slide + " (" + 83 + "%)");
          
          hideEntireActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '99') {
          $("#e-lecture").html("slide " + slide + " (" + 87 + "%)");
          
          hideEntireActionsPanel();
 
          showStatusPanel();
          showCodetracePanel();
      
        }
        if (slide == '99-1') {
          $("#e-lecture").html("slide " + slide + " (" + 91 + "%)");
          
          hideEntireActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '99-2') {
          $("#e-lecture").html("slide " + slide + " (" + 95 + "%)");
          
          hideEntireActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
        if (slide == '99-3') {
          $("#e-lecture").html("slide " + slide + " (" + 100 + "%)");
          
          hideEntireActionsPanel();
          hideStatusPanel();
          hideCodetracePanel();
      
        }
      }

      window.onpopstate = function(event) {
        var slide = event.state['slide'];
        openSlide(slide, function() {
          runSlide(slide);
        });
      };

      function getUrlParameter(sParam) {
        var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'), sParameterName, i;

        for (i = 0; i < sURLVariables.length; i++) {
          sParameterName = sURLVariables[i].split('=');
          if (sParameterName[0] === sParam) return sParameterName[1] === undefined ? true : sParameterName[1];
        }
      };

      function pushState(slideValue) {
        var url = '/zh/fenwicktree';
        if (typeof slideValue != 'undefined' && slideValue != null) url += '?slide=' + slideValue;
        window.history.pushState({slide: slideValue}, "slide " + slideValue, url);
      }

      function showPopup(callback) {
        $('#popup').fadeIn(100, callback);
      }

      function hidePopup(callback) {
        $('#popup').fadeOut(100, callback);
      }

      function showOverlay() {
        $('#overlay').css('opacity', 0.5); 
        $('#overlay').show();
      }

      function hideOverlay() {
        $('#overlay').hide();
        $("#e-lecture").html("");
      }

      function makeOverlayTransparent() {
        $('#overlay').css('opacity', 0);
      }

      function hideSlide(callback) {
        isPlaying = true;
        closeSlide(cur_slide, function() {
          makeOverlayTransparent();
          setTimeout(callback, 700); // don't immediately run the animation, wait for 500ms+ first
        });
      }

      function showSlide() {
        isPlaying = false;
        openSlide(cur_slide);
        showOverlay();
      }

      $(function() {
        var slide = getUrlParameter('slide');
        
        $.get('/hasvisited' + '/fenwicktree', function(data) {
          var hasVisited = data['hasvisited'] == '1';
          if (!hasVisited) {
            var postData = {
              '_token': 'kaTPcaTtnnJPvGspW7LRTya6UONjjAL7yXZSCSBh',
              'page': '/fenwicktree'.substring(1),
            };

            $.post("/visitpage", postData, function(data) {
              // non critical request...
            });

            if (typeof slide != undefined && slide != null) {
              cur_slide = slide;
            }

            $("#mode-menu a").trigger("click");
          }
          else {
            if (typeof slide != undefined && slide != null) {
              cur_slide = slide;
              $('#mode-menu a').click();
            }    
          }
        }).fail(function() {
          if (typeof slide != undefined && slide != null) {
            cur_slide = slide;
            $('#mode-menu a').click();
          }
        });

        $('.mcq-submit').click(function() {
          var questionId = parseInt($(this).attr('id').split('-')[1]);
          var answer = $('#mcq-answer-' + questionId).val();
          var userAnswer = $('input[type=radio][name=mcq-'+questionId+'-choice]:checked').val();

          if (answer === userAnswer) {
            $('#answer-status-' + questionId).html('<font color="green"><b>Correct!</b></font>');
          }
          else {
            $('#answer-status-' + questionId).html('<font color="red"><b>Wrong Answer! Try again...</b></font>');
          }
          $('#answer-status-' + questionId).show();
          setTimeout(function() {
            $('#answer-status-' + questionId).fadeOut(1000);
          }, 1000);
        });

        $('.msq-submit').click(function() {
          var questionId = parseInt($(this).attr('id').split('-')[1]);
          var answer = $('#msq-answer-' + questionId).val();

          var answers = [];
          $('input[type=checkbox][class=msq-choice]:checked').each(function() {
            answers.push($(this).attr('id').split('-')[3]);
          });
          answers.sort();
          var userAnswer = answers.join(',');

          if (answer === userAnswer) {
            $('#answer-status-' + questionId).html('<font color="green">Correct!</font>');
          }
          else {
            $('#answer-status-' + questionId).html('<font color="red">Wrong Answer! Try again...</font>');
          }
          $('#answer-status-' + questionId).show();
          setTimeout(function() {
            $('#answer-status-' + questionId).fadeOut(1000);
          }, 1000);
        });

        $('select.lecture-dropdown').change(function() {
          var nextSlide = $(this).val();
          openSlide(nextSlide, function() {
            runSlide(nextSlide);
            pushState(nextSlide);
          });
        });

        $('#hide-popup').click(function() {
          hidePopup();
        });

        $('#popup').hover(function() {
          $('#hide-popup').show();
        }, function() {
          $('#hide-popup').hide();
        });

        $('#electure-1 .electure-next').click(function() {
          hidePopup();
          runSlide('1-1');
          pushState('1-1');
        });
      
        $('#electure-1-1 .electure-next').click(function() {
          hidePopup();
          runSlide('1-2');
          pushState('1-2');
        });
        $('#electure-1-1 .electure-prev').click(function() {
          hidePopup();
          runSlide('1');
          pushState('1');
        });
      
        $('#electure-1-2 .electure-next').click(function() {
          hidePopup();
          runSlide('1-3');
          pushState('1-3');
        });
        $('#electure-1-2 .electure-prev').click(function() {
          hidePopup();
          runSlide('1-1');
          pushState('1-1');
        });
      
        $('#electure-1-3 .electure-next').click(function() {
          hidePopup();
          runSlide('2');
          pushState('2');
        });
        $('#electure-1-3 .electure-prev').click(function() {
          hidePopup();
          runSlide('1-2');
          pushState('1-2');
        });
      
        $('#electure-2 .electure-next').click(function() {
          hidePopup();
          runSlide('3');
          pushState('3');
        });
        $('#electure-2 .electure-prev').click(function() {
          hidePopup();
          runSlide('1-3');
          pushState('1-3');
        });
      
        $('#electure-3 .electure-next').click(function() {
          hidePopup();
          runSlide('3-1');
          pushState('3-1');
        });
        $('#electure-3 .electure-prev').click(function() {
          hidePopup();
          runSlide('2');
          pushState('2');
        });
      
        $('#electure-3-1 .electure-next').click(function() {
          hidePopup();
          runSlide('3-2');
          pushState('3-2');
        });
        $('#electure-3-1 .electure-prev').click(function() {
          hidePopup();
          runSlide('3');
          pushState('3');
        });
      
        $('#electure-3-2 .electure-next').click(function() {
          hidePopup();
          runSlide('3-3');
          pushState('3-3');
        });
        $('#electure-3-2 .electure-prev').click(function() {
          hidePopup();
          runSlide('3-1');
          pushState('3-1');
        });
      
        $('#electure-3-3 .electure-next').click(function() {
          hidePopup();
          runSlide('3-4');
          pushState('3-4');
        });
        $('#electure-3-3 .electure-prev').click(function() {
          hidePopup();
          runSlide('3-2');
          pushState('3-2');
        });
      
        $('#electure-3-4 .electure-next').click(function() {
          hidePopup();
          runSlide('3-5');
          pushState('3-5');
        });
        $('#electure-3-4 .electure-prev').click(function() {
          hidePopup();
          runSlide('3-3');
          pushState('3-3');
        });
      
        $('#electure-3-5 .electure-next').click(function() {
          hidePopup();
          runSlide('3-6');
          pushState('3-6');
        });
        $('#electure-3-5 .electure-prev').click(function() {
          hidePopup();
          runSlide('3-4');
          pushState('3-4');
        });
      
        $('#electure-3-6 .electure-next').click(function() {
          hidePopup();
          runSlide('4');
          pushState('4');
        });
        $('#electure-3-6 .electure-prev').click(function() {
          hidePopup();
          runSlide('3-5');
          pushState('3-5');
        });
      
        $('#electure-4 .electure-next').click(function() {
          hidePopup();
          runSlide('5');
          pushState('5');
        });
        $('#electure-4 .electure-prev').click(function() {
          hidePopup();
          runSlide('3-6');
          pushState('3-6');
        });
      
        $('#electure-5 .electure-next').click(function() {
          hidePopup();
          runSlide('5-1');
          pushState('5-1');
        });
        $('#electure-5 .electure-prev').click(function() {
          hidePopup();
          runSlide('4');
          pushState('4');
        });
      
        $('#electure-5-1 .electure-next').click(function() {
          hidePopup();
          runSlide('6');
          pushState('6');
        });
        $('#electure-5-1 .electure-prev').click(function() {
          hidePopup();
          runSlide('5');
          pushState('5');
        });
      
        $('#electure-6 .electure-next').click(function() {
          hidePopup();
          runSlide('7');
          pushState('7');
        });
        $('#electure-6 .electure-prev').click(function() {
          hidePopup();
          runSlide('5-1');
          pushState('5-1');
        });
      
        $('#electure-7 .electure-next').click(function() {
          hidePopup();
          runSlide('7-1');
          pushState('7-1');
        });
        $('#electure-7 .electure-prev').click(function() {
          hidePopup();
          runSlide('6');
          pushState('6');
        });
      
        $('#electure-7-1 .electure-next').click(function() {
          hidePopup();
          runSlide('8');
          pushState('8');
        });
        $('#electure-7-1 .electure-prev').click(function() {
          hidePopup();
          runSlide('7');
          pushState('7');
        });
      
        $('#electure-8 .electure-next').click(function() {
          hidePopup();
          runSlide('8-1');
          pushState('8-1');
        });
        $('#electure-8 .electure-prev').click(function() {
          hidePopup();
          runSlide('7-1');
          pushState('7-1');
        });
      
        $('#electure-8-1 .electure-next').click(function() {
          hidePopup();
          runSlide('99');
          pushState('99');
        });
        $('#electure-8-1 .electure-prev').click(function() {
          hidePopup();
          runSlide('8');
          pushState('8');
        });
      
        $('#electure-99 .electure-next').click(function() {
          hidePopup();
          runSlide('99-1');
          pushState('99-1');
        });
        $('#electure-99 .electure-prev').click(function() {
          hidePopup();
          runSlide('8-1');
          pushState('8-1');
        });
      
        $('#electure-99-1 .electure-next').click(function() {
          hidePopup();
          runSlide('99-2');
          pushState('99-2');
        });
        $('#electure-99-1 .electure-prev').click(function() {
          hidePopup();
          runSlide('99');
          pushState('99');
        });
      
        $('#electure-99-2 .electure-next').click(function() {
          hidePopup();
          runSlide('99-3');
          pushState('99-3');
        });
        $('#electure-99-2 .electure-prev').click(function() {
          hidePopup();
          runSlide('99-1');
          pushState('99-1');
        });
      
        $('#electure-99-3 .electure-prev').click(function() {
          hidePopup();
          runSlide('99-2');
          pushState('99-2');
        });
      
 

        // temporary quick fix for Google Chrome Aug 2016 issue..., put at last part so that everything else has been loaded
        // setTimeout(function(){ document.body.style.zoom = "100.1%"; }, 500);
        // setTimeout(function(){ document.body.style.zoom = "100%"; }, 600);
        // I turn it off on 14 June 2018, seems 'ok'?
      });


      function adjustPopupToImageSize() {
        var width = $('#popup-image').prop('width');
        var height = $('#popup-image').prop('height');
        $('#popup').width(width + 20);
        $('#popup').height(height + 20);
        if (width == 0 && height == 0) {
          setTimeout(adjustPopupToImageSize, 200);
        } else {
          showPopup();  
        }
      }

      function POPUP_IMAGE(url) {
        $('#popup-content').html('<img id="popup-image" src="' + url + '">');
        adjustPopupToImageSize();
      }

      function URL(url) {
        window.open(url, '_blank');
      }

      // Implement these functions in each visualisation
      // This function will be called before entering e-Lecture Mode
      function ENTER_LECTURE_MODE() {}

      // This function will be called before returning to Explore Mode
      function ENTER_EXPLORE_MODE() {}

      // Lecture action functions
      function CUSTOM_ACTION(action, data, mode) {}
    </script>
<script type="text/javascript">
// Fenwick Tree Widget
// original author: Jonathan Irvin Gunawan

// Binary Indexed Tree example Constatnts
var INF = 1000000000;
var POINT_UPDATE_RANGE_QUERY = 0;
var RANGE_UPDATE_POINT_QUERY = 1;
var RANGE_UPDATE_RANGE_QUERY = 2;
var BITType;

var actions = [".point-update-range-query-actions ",".range-update-point-query-actions ",".range-update-range-query-actions "];

var BIT = function() {
  var self = this;
  var graphWidget = new GraphWidget();

  /*
   *  Structure of internalAdjList: JS object with
   *  - key: vertex number
   *  - value: JS object with
   *           - key: the other vertex number that is connected by the edge
   *           - value: ID of the edge, NOT THE WEIGHT OF THE EDGE
   *
   *  The reason why the adjList didn't store edge weight is because it will be easier to create bugs
   *  on information consistency between the adjList and edgeList
   *
   *  Structure of internalEdgeList: JS object with
   *  - key: edge ID
   *  - value: JS object with the following keys:
   *           - vertexA
   *           - vertexB
   *           - weight
   */

  var internalAdjList = {};
  var internalEdgeList = {};
  var amountVertex = 0;
  var amountEdge = 0;
  var stateList = [];
  var numberOfData;
  var pseudocode;

  var LSOne = function(point) {
    return (point & -point);
  }

  this.getGraphWidget = function() {
    return graphWidget;
  }

  this.fill = function() {
    if (BITType == POINT_UPDATE_RANGE_QUERY) {
      numberOfData = 10;
      var cpbook_example = '0,1,0,1,2,3,2,1,1,0';
      var data = cpbook_example.split(',');
      for (var i = 0; i < data.length; ++i)
        data[i] = (+data[i]);

      for (var i = 1; i <= numberOfData; i++) {
        internalAdjList[i + numberOfData]["text"] = data[i-1]; // Math.floor(Math.random()*10);
        for (var j = i; j <= numberOfData; j += LSOne(j))
          internalAdjList[j]["text"] += internalAdjList[i + numberOfData]["text"];
      }
    } /*else if (BITType == RANGE_UPDATE_POINT_QUERY)
    {
      for (var i = 1; i <= numberOfData; ++i)
      {
        internalAdjList[i + numberOfData]["text"] = Math.floor(Math.random() * 10);
        for (var j = i; j <= numberOfData; j += LSOne(j))
          internalAdjList[j]["text"] += internalAdjList[i + numberOfData]["text"];
        for (var j = i+1; j <= numberOfData; j += LSOne(j))
          internalAdjList[j]["text"] -= internalAdjList[i + numberOfData]["text"];
      }
    } *//*else if (BITType == RANGE_UPDATE_RANGE_QUERY)
    {
      for (var i = 1; i <= numberOfData; ++i)
      {
        internalAdjList[i + 2 * numberOfData]["text"] = Math.floor(Math.random() * 10);
        for (var j = i; j <= numberOfData; j += LSOne(j))
          internalAdjList[j]["text"] += internalAdjList[i + 2 * numberOfData]["text"];
        for (var j = i+1; j <= numberOfData; j += LSOne(j))
          internalAdjList[j]["text"] -= internalAdjList[i + 2 * numberOfData]["text"];
        for (var j = i; j <= numberOfData; j += LSOne(j))
          internalAdjList[j + numberOfData]["text"] -= internalAdjList[i + 2 * numberOfData]["text"] * (i - 1);
        for (var j = i+1; j <= numberOfData; j += LSOne(j))
          internalAdjList[j + numberOfData]["text"] -= internalAdjList[i + 2 * numberOfData]["text"] * (i);
      }
    }*/
    var newState = createState(internalAdjList, internalEdgeList);
    graphWidget.updateGraph(newState,500);
  }

  this.resize = function(numberOfVertex) {
    amountEdge = 0;
    internalEdgeList = {};
    internalAdjList = {};
    numberOfData = numberOfVertex;
    amountVertex = numberOfData * 2;
    $('.point-update-range-query-actions #query-input-right').val(numberOfData-1);
    $('.range-update-range-query-actions #query-input-right').val(numberOfData-1);
    $('.range-update-point-query-actions #update-input-right').val(numberOfData-1);
    $('.range-update-range-query-actions #update-input-right').val(numberOfData-1);

    if (BITType == RANGE_UPDATE_POINT_QUERY || BITType == POINT_UPDATE_RANGE_QUERY) {
      for (var i = 0; i <= numberOfData; ++i) {
        internalAdjList[i] = {
          "cx": (numberOfData == 1 ? 850 : 50 + 800 / numberOfData * i),
          "cy": 50,
          "text": 0,
          "extratext" : i
        }
      }
      for (var i = 1; i <= numberOfData; ++i) {
        internalAdjList[numberOfData + i] = {
          "cx": (numberOfData == 1 ? 850 : 50 + 800 / numberOfData * i),
          "cy": 350,
          "text": 0,
          "extratext" : i,
          "state" : VERTEX_BLUE_FILL
        }
      }
    }
    else if (BITType == RANGE_UPDATE_RANGE_QUERY) {
      amountVertex += numberOfData;
      for (var i = 1; i <= numberOfData; i++) {
        internalAdjList[i] = {
          "cx": (numberOfData == 1 ? 850 : 50 + 800 / (numberOfData-1) * (i-1)),
          "cy": 50,
          "text": 0,
          "extratext" : i
        }
      }
      for (var i = 1; i <= numberOfData; i++) {
        internalAdjList[numberOfData+i] = {
          "cx": (numberOfData == 1 ? 850 : 50 + 800 / (numberOfData-1) * (i-1)),
          "cy": 250,
          "text": 0,
          "extratext" : i
        }
      }
      for (var i = 1; i <= numberOfData; i++) {
        internalAdjList[2 * numberOfData+i] = {
          "cx": (numberOfData == 1 ? 850 : 50 + 800 / (numberOfData-1) * (i-1)),
          "cy": 450,
          "text": 0,
          "extratext" : i,
          "state" : VERTEX_BLUE_FILL
        }
      }
    }
    return true;
  }

  var createUpdatingTree = function(point,topLimit,yDifference,incIndex) {
    if (yDifference == null) yDifference = 50;
    if (incIndex == null) incIndex = 0;
    internalAdjList[point + incIndex]["cx"] = (numberOfData == 1 ? 850 : 50 + 800 / numberOfData * point);
    internalAdjList[point + incIndex]["cy"] = topLimit;
    for (var i = 0; i < point; i++)
      if (i + LSOne(i) == point) {
        internalEdgeList[amountEdge] =  {
          "vertexA" : i+incIndex,
          "vertexB" : point+incIndex,
        }
        internalAdjList[point+incIndex][i+incIndex] = amountEdge;
        internalAdjList[i+incIndex][point+incIndex] = amountEdge;
        amountEdge++;
        createUpdatingTree(i,topLimit + yDifference,yDifference,incIndex);
      }
    // link to dummy N+1
    if (point + LSOne(point) > numberOfData) {
      internalEdgeList[amountEdge] =  {
        "vertexA" : point,
        "vertexB" : 0,
      }
      internalAdjList[point][0] = amountEdge;
      internalAdjList[0][point] = amountEdge;
      amountEdge++;
    }
  }

  var updatePoint = function(position, value) {
    if (position > numberOfData) return true;
    internalEdgeList = {};
    amountEdge = 0;
    for (var i = 1; i <= numberOfData; i++)
      if (i + LSOne(i) >= numberOfData)
        createUpdatingTree(i,100);

    internalAdjList[0]["cx"] = 50 + 800 / numberOfData * (numberOfData+1); // root, rightmost
    internalAdjList[0]["cy"] = 50; // root
    internalAdjList[0]["text"] = 'R'; // root/(N+1)
    internalAdjList[0]["extratext"] = (numberOfData+1);
    for (var i = 1; i <= numberOfData; ++i)
      internalAdjList[i + numberOfData]["state"] = VERTEX_DEFAULT;
    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'Creating the update tree';
    if (pseudocode == 0)
      cs["lineNo"] = [1];
    else if (pseudocode == 6) 
      cs["lineNo"] = [2,3];
    else if (pseudocode == 2)
      cs["lineNo"] = [2];

    stateList.push(cs);

    var edgeIndex = -1;

    while (position <= numberOfData) {
      for (var i = 0; i <= numberOfData; ++i)
        internalAdjList[numberOfData+i]["state"] = VERTEX_DEFAULT;
      for (var i = position-LSOne(position)+1; i <= position; ++i)
        internalAdjList[numberOfData+i]["state"] = VERTEX_BLUE_FILL;
      internalAdjList[position]["text"] += value;
      internalAdjList[position]["state"] = VERTEX_HIGHLIGHTED;
      cs = createState(internalAdjList, internalEdgeList);
      cs["status"] = 'position = ' + position;
      cs["status"] += '<br>BIT[' + position + '] = ' + (internalAdjList[position]["text"] - value);
      cs["status"] += ' + ' + value + ' = ' + internalAdjList[position]["text"] + '</br>';
      if (pseudocode == 0)
        cs["lineNo"] = [2,3,4];
      else if (pseudocode == 6) 
        cs["lineNo"] = [2,3];
      else if (pseudocode == 2)
        cs["lineNo"] = [3,4,5];
      stateList.push(cs);
      if (edgeIndex != -1) {
        internalEdgeList[edgeIndex]["state"] = EDGE_DEFAULT;
        internalEdgeList[edgeIndex]["animateHighlighted"] = false;
      }
      if (position + LSOne(position) <= numberOfData) {
        edgeIndex = internalAdjList[position][position + LSOne(position)];
        internalEdgeList[edgeIndex]["state"] = EDGE_RED;
        internalEdgeList[edgeIndex]["animateHighlighted"] = true;
      }
      else if (position + LSOne(position) > numberOfData) {
        edgeIndex = internalAdjList[position][0]; // special edge
        internalEdgeList[edgeIndex]["state"] = EDGE_RED;
        internalEdgeList[edgeIndex]["animateHighlighted"] = true;
      }
      position += LSOne(position);
    }

    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'position = ' + position + '. position > N';
    cs["status"] += '<br>Update done</br>';
    stateList.push(cs);
    
    return true;
  }

  this.updatePoint = function(position,value) {
    if (position <= 0 || position > numberOfData) {
      $(actions[BITType] + '#update-err').html('position must be between 1 and {numofData} inclusive.'.replace("{numOfData}", numberOfData));
      return false;
    }
    pseudocode = 0;
    
    stateList = [];

    for (key in internalEdgeList) {
      internalEdgeList[key]["state"] = EDGE_DEFAULT;
      internalEdgeList[key]["animateHighlighted"] = false;
    }
    for (var i = 0; i <= numberOfData; ++i)
      internalAdjList[numberOfData+i]["state"] = VERTEX_DEFAULT;
    for (var i = 0; i <= numberOfData; ++i)
      internalAdjList[numberOfData+i]["state"] = VERTEX_DEFAULT;
    internalAdjList[position + numberOfData]["text"] += value;
    internalAdjList[position + numberOfData]["state"] = VERTEX_HIGHLIGHTED;
    cs = createState(internalAdjList,internalEdgeList);
    cs["status"] = 'Updating array' + '<br>idx ' + position + ' += ' + value + ' (' + (internalAdjList[position + numberOfData]["text"]-value) + '->' + internalAdjList[position + numberOfData]["text"] + ')';
    stateList.push(cs);
    internalAdjList[position + numberOfData]["state"] = VERTEX_BLUE_FILL;
    
    if (!updatePoint(position,value)) 
      return false;
    graphWidget.startAnimation(stateList);
    populatePseudocode(pseudocode);
    return true;
  }

  var updateRange = function(positionLeft,positionRight,value) {
    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'Updating (' + positionLeft + ',' + value + ')';
    if (pseudocode == 6)
      cs["lineNo"] = [2,3];
    else cs["lineNo"] = [6];
    stateList.push(cs);
    if (!updatePoint(positionLeft,value)) 
      return false;
    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'Updating (' + (positionRight+1) + ',' + (-value) + ')';
    if (pseudocode == 6)
      cs["lineNo"] = [2,3];
    else cs["lineNo"] = [7];
    stateList.push(cs);
    if (!updatePoint(positionRight+1,-value)) 
      return false;
    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'Update done';
    if (pseudocode == 6)
      cs["lineNo"] = [2,3];
    else cs["lineNo"] = [7];
    stateList.push(cs);
    return true;
  }

  this.updateRange = function(positionLeft,positionRight,value) {
    pseudocode = 2;
    if (positionLeft > positionRight) {
      $(actions[BITType] + '#update-err').html('left position must be smaller or equal to right position');
      return false;
    }
    if (positionLeft <= 0) {
      $(actions[BITType] + '#update-err').html('left position must be between 1 and {numofData} inclusive.'.replace("{numOfData}", numberOfData));
      return false;
    }
    if (positionRight >= numberOfData) {
      $(actions[BITType] + '#update-err').html('left position must be between 1 and {numofData} inclusive.'.replace("{numOfData}", (numberOfData-1)));
      return false;
    }
    
    stateList = [];
    
    for (var i = positionLeft; i <= positionRight; ++i) {
      internalAdjList[i + numberOfData]["text"] += value;
      internalAdjList[i + numberOfData]["state"] = VERTEX_HIGHLIGHTED;
    }
    cs = createState(internalAdjList,internalEdgeList);
    cs["status"] = 'Updating array';
    stateList.push(cs);
    for (var i = positionLeft; i <= positionRight; ++i) {
      internalAdjList[i + numberOfData]["state"] = VERTEX_BLUE_FILL;
    }

    if (!updateRange(positionLeft,positionRight,value)) return false;
    graphWidget.startAnimation(stateList);
    populatePseudocode(pseudocode);
    return true;
  }

  var updatePointV2 = function(position,value,incIndex,lineNumber) {
    if (position > numberOfData) return true;
    internalEdgeList = {};
    amountEdge = 0;

    if (incIndex == 0) {
      for (var i = 1; i <= numberOfData; ++i) if(i + LSOne(i) > numberOfData)
        createUpdatingTree(i,50,25,0);
    }
    else {
      for (var i = 1; i <= numberOfData; ++i) if(i + LSOne(i) > numberOfData)
        createUpdatingTree(i,250,25,numberOfData);
    }

    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'Creating the update tree';
    cs["lineNo"] = lineNumber;
    

    stateList.push(cs);

    var edgeIndex = -1;

    while (position <= numberOfData) {
      internalAdjList[position + incIndex]["text"] += value;
      internalAdjList[position + incIndex]["state"] = VERTEX_HIGHLIGHTED;
      cs = createState(internalAdjList, internalEdgeList);
      cs["status"] = 'position = ' + position;
      cs["status"] += '<br>BIT[' + position + '] = ' + (internalAdjList[position + incIndex]["text"] - value);
      cs["status"] += ' + ' + value + ' = ' + internalAdjList[position + incIndex]["text"] + '</br>';
      cs["lineNo"] = lineNumber;
      stateList.push(cs);
      internalAdjList[position + incIndex]["state"] = VERTEX_DEFAULT;
      if (edgeIndex != -1) {
        internalEdgeList[edgeIndex]["state"] = EDGE_DEFAULT;
        internalEdgeList[edgeIndex]["animateHighlighted"] = false;
      }
      if (position + LSOne(position) <= numberOfData) {
        edgeIndex = internalAdjList[position + incIndex][position + LSOne(position) + incIndex];
        internalEdgeList[edgeIndex]["state"] = EDGE_RED;
        internalEdgeList[edgeIndex]["animateHighlighted"] = true;
      }
      position += LSOne(position);
    }

    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'position = ' + position + '. position > N';
    cs["status"] += '<br>Update done</br>';
    cs["lineNo"] = lineNumber;
    stateList.push(cs);
    
    return true;
  }

  var updateRangeV2 = function(positionLeft,positionRight,value,lineNumber)   {
    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'BIT1 updating(' + positionLeft + ',' + value + ')';
    cs["lineNo"] = [lineNumber == null ? 2 : lineNumber];
    stateList.push(cs);
    if (!updatePointV2(positionLeft,value,0,lineNumber == null ? 2 : lineNumber))
      return false;

    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'BIT1 updating(' + (positionRight + 1) + ',' + ( -value ) + ')';
    cs["lineNo"] = [lineNumber == null ? 3 : lineNumber];
    stateList.push(cs);
    if (!updatePointV2(positionRight + 1,-value,0,lineNumber == null ? 3 : lineNumber))
      return false;

    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'BIT2 updating(' + (positionLeft) + ',' + ( value * (positionLeft - 1) ) + ')';
    cs["lineNo"] = [lineNumber == null ? 4 : lineNumber];
    stateList.push(cs);
    if (!updatePointV2(positionLeft,value * (positionLeft - 1),numberOfData,lineNumber == null ? 4 : lineNumber))
      return false;

    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'BIT2 updating(' + (positionRight + 1) + ',' + ( -value * positionRight ) + ')';
    cs["lineNo"] = [lineNumber == null ? 5 : lineNumber];
    stateList.push(cs);
    if (!updatePointV2(positionRight + 1,-value * positionRight,numberOfData,lineNumber == null ? 5 : lineNumber))
      return false;

    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'Update done';
    stateList.push(cs);
    return true;
  }

  this.updateRangeV2 = function(positionLeft,positionRight,value) { // for RURQ
    pseudocode = 4;
    if (positionLeft > positionRight) {
      $(actions[BITType] + '#update-err').html('left position must be smaller or equal to right position');
      return false;
    }
    if (positionLeft <= 0) {
      $(actions[BITType] + '#update-err').html('left position must be between 1 and {numofData} inclusive.'.replace("{numOfData}", numberOfData));
      return false;
    }
    if (positionRight >= numberOfData) {
      $(actions[BITType] + '#update-err').html('left position must be between 1 and {numofData} inclusive.'.replace("{numOfData}", (numberOfData-1)));
      return false;
    }
    
    stateList = [];
    
    for (var i = positionLeft; i <= positionRight; ++i) {
      internalAdjList[i + 2 * numberOfData]["text"] += value;
      internalAdjList[i + 2 * numberOfData]["state"] = VERTEX_HIGHLIGHTED;
    }
    cs = createState(internalAdjList,internalEdgeList);
    cs["status"] = 'Updating array';
    stateList.push(cs);
    for (var i = positionLeft; i <= positionRight; ++i) {
      internalAdjList[i + 2 * numberOfData]["state"] = VERTEX_BLUE_FILL;
    }

    if (!updateRangeV2(positionLeft,positionRight,value)) return false;
    graphWidget.startAnimation(stateList);
    populatePseudocode(pseudocode);
    return true;
  }

  var createQueryTree = function(point,topLimit,yDifference,incIndex) {
    if (yDifference == null) yDifference = 50;
    if (incIndex == null) incIndex = 0;
    internalAdjList[point + incIndex]["cx"] = (numberOfData == 1 ? 850 : 50 + 800 / numberOfData * point);
    internalAdjList[point + incIndex]["cy"] = topLimit;
    for (var i = point+1; i <= numberOfData; ++i) if (i - LSOne(i) == point) {
      internalEdgeList[amountEdge] = {
        "vertexA" : i + incIndex,
        "vertexB" : point + incIndex,
      }
      internalAdjList[point + incIndex][i + incIndex] = amountEdge;
      internalAdjList[i + incIndex][point + incIndex] = amountEdge;
      ++amountEdge;
      createQueryTree(i,topLimit + 50,yDifference,incIndex);
    }
  }

  var prefixSum = function(position) {
    var sum = 0;
    var startPosition = position;
    var edgeIndex = -1;

    for (var i = 1; i <= numberOfData; ++i)
      internalAdjList[i + numberOfData]["state"] = VERTEX_DEFAULT;
    while (position > 0) {
      internalAdjList[position]["state"] = VERTEX_HIGHLIGHTED;
      for (var i = position-LSOne(position)+1; i <= position; ++i)
        internalAdjList[numberOfData + i]["state"] = VERTEX_HIGHLIGHTED;
      cs = createState(internalAdjList, internalEdgeList);
      cs["status"] = 'RSQ(1,' + startPosition + ') = ' + sum + ' + RSQ(' + (position-LSOne(position)+1) + "," + position + ") = " + sum + " + " + internalAdjList[position]["text"] + ' = ';
      cs["status"] += sum + internalAdjList[position]["text"];
      cs["lineNo"] = [4,5,6];
      stateList.push(cs);
      internalAdjList[position]["state"] = VERTEX_DEFAULT;
      sum += internalAdjList[position]["text"];
      if (edgeIndex != -1) {
        internalEdgeList[edgeIndex]["state"] = EDGE_DEFAULT;
        internalEdgeList[edgeIndex]["animateHighlighted"] = false;
      }
      if (position - LSOne(position) >= 0) {
        edgeIndex = internalAdjList[position][position - LSOne(position)];
        internalEdgeList[edgeIndex]["state"] = EDGE_RED;
        internalEdgeList[edgeIndex]["animateHighlighted"] = true;
      }
      position -= LSOne(position);
    }
    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'RSQ(1,' + startPosition + ') = ' + sum;
    cs["lineNo"] = [2];
    stateList.push(cs);

    return sum;
  }

  var sumRange = function(positionLeft,positionRight) {
    internalEdgeList = {};
    amountEdge = 0;
    for (var i = 0; i <= numberOfData; ++i) {
      if (i - LSOne(i) == 0)
        createQueryTree(i,100);
    }
    internalAdjList[0]["cy"] = 50; // root
    internalAdjList[0]["text"] = "0";
    internalAdjList[0]["extratext"] = "0";
    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'Creating the interrogation tree';
    cs["lineNo"] = [1];
    stateList.push(cs);

    for (key in internalEdgeList) {
      internalEdgeList[key]["state"] = EDGE_DEFAULT;
      internalEdgeList[key]["animateHighlighted"] = false;
    }
    var sumRight = prefixSum(positionRight);
    for (key in internalEdgeList) {
      internalEdgeList[key]["state"] = EDGE_DEFAULT;
      internalEdgeList[key]["animateHighlighted"] = false;
    }
    var sumLeft = prefixSum(positionLeft-1);

    for (var i = 1; i <= numberOfData; ++i)
      internalAdjList[i + numberOfData]["state"] = VERTEX_DEFAULT;
    for (var i = positionLeft; i <= positionRight; ++i)
      internalAdjList[i + numberOfData]["state"] = VERTEX_HIGHLIGHTED;
    for (key in internalEdgeList) {
      internalEdgeList[key]["state"] = EDGE_DEFAULT;
      internalEdgeList[key]["animateHighlighted"] = false;
    }
    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'RSQ(' + positionLeft + ',' + positionRight + ')';
    cs["status"] += ' = RSQ(1,' + positionRight + ') - RSQ(1,' + (positionLeft-1) + ')';
    cs["status"] += ' = ' + sumRight + ' - ' + sumLeft + ' = ' + (sumRight - sumLeft);
    cs["lineNo"] = [7];
    stateList.push(cs);
  
    return true;
  }

  this.sumRange = function(positionLeft,positionRight) {
    if (positionLeft > positionRight) {
      $(actions[BITType] + '#query-err').html('left position must be smaller or equal to right position');
      return false;
    }
    if (positionLeft <= 0) {
      $(actions[BITType] + '#query-err').html('left position must be between 1 and {numofData} inclusive.'.replace("{numOfData}", numberOfData));
      return false;
    }
    if (positionRight > numberOfData) {
      $(actions[BITType] + '#query-err').html('left position must be between 1 and {numofData} inclusive.'.replace("{numOfData}", numberOfData));
      return false;
    }
    pseudocode = 1;
    stateList = [];

    sumRange(positionLeft,positionRight)

    graphWidget.startAnimation(stateList);
    populatePseudocode(pseudocode);
    return true;
  }

  var sumPoint = function(position) {
    internalEdgeList = {};
    amountEdge = 0;
    for (var i = 1; i <= numberOfData; ++i) {
      if (i - LSOne(i) == 0)
        createQueryTree(i,50);
    }
    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'Creating the interrogation tree';
    cs["lineNo"] = [2];
    stateList.push(cs);

    var sum = prefixSum(position);

    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'data[' + position + '] = RSQ(1,' + position + ') = ' + sum;
    cs["lineNo"] = [7];
    stateList.push(cs);

    return true;
  }

  this.sumPoint = function(position) {
    pseudocode = 3;
    if (position <= 0 || position > numberOfData) {
      $(actions[BITType] + '#query-err').html('position must be between 1 and {numofData} inclusive.'.replace("{numOfData}", numberOfData));
      return false;
    }
    stateList = [];
    internalAdjList[position + numberOfData]["state"] = VERTEX_HIGHLIGHTED;
    if (!sumPoint(position)) return false;
    internalAdjList[position + numberOfData]["state"] = VERTEX_BLUE_FILL;

    graphWidget.startAnimation(stateList);
    populatePseudocode(pseudocode);
    return true;
  }

  var prefixSumV2 = function(position,incIndex,lineNumber) {
    var sum = 0;
    var startPosition = position;
    var edgeIndex = -1;

    while (position > 0) {
      internalAdjList[position + incIndex]["state"] = VERTEX_HIGHLIGHTED;
      cs = createState(internalAdjList, internalEdgeList);
      cs["status"] = 'RSQ(1,' + startPosition + ') = ' + sum + ' + ' + internalAdjList[position + incIndex]["text"] + ' = ';
      cs["status"] += sum + internalAdjList[position + incIndex]["text"];
      cs["lineNo"] = [lineNumber];
      stateList.push(cs);
      internalAdjList[position + incIndex]["state"] = VERTEX_DEFAULT;
      sum += internalAdjList[position + incIndex]["text"];
      if (edgeIndex != -1) {
        internalEdgeList[edgeIndex]["state"] = EDGE_DEFAULT;
        internalEdgeList[edgeIndex]["animateHighlighted"] = false;
      }
      if (position - LSOne(position) > 0) {
        edgeIndex = internalAdjList[position + incIndex][position - LSOne(position) + incIndex];
        internalEdgeList[edgeIndex]["state"] = EDGE_RED;
        internalEdgeList[edgeIndex]["animateHighlighted"] = true;
      }
      position -= LSOne(position);
    }
    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'RSQ(1,' + startPosition + ') = ' + sum;
    cs["lineNo"] = [lineNumber];
    stateList.push(cs);

    return sum;
  }

  var sumPointV2 = function(position) {
    internalEdgeList = {};
    amountEdge = 0;
    for (var i = 1; i <= numberOfData; ++i) {
      if (i - LSOne(i) == 0)
        createQueryTree(i,50,25,0);
    }
    for (var i = 1; i <= numberOfData; ++i) {
      if (i - LSOne(i) == 0)
        createQueryTree(i,250,25,numberOfData);
    }
    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'Creating the interrogation tree';
    cs["lineNo"] = [1,2,3,4];
    stateList.push(cs);


    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'Computing RSQ([1, {pos}]) on {bit}'.replace("{pos}", position).replace("{bit}", "BIT1");
    cs["lineNo"] = [2];
    stateList.push(cs);
    var sumBIT1 = prefixSumV2(position,0,2);



    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'Computing RSQ([1, {pos}]) on {bit}'.replace("{pos}", position).replace("{bit}", "BIT2");
    cs["lineNo"] = [3];
    stateList.push(cs);
    var sumBIT2 = prefixSumV2(position,numberOfData,3);


    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'RSQ([1,' + position + ']) = RSQ(BIT1,[1,' + position + ']) * ' + position + ' - RSQ(BIT2,[1,' + position + '])';
    cs["status"] += '<br>' + sumBIT1 + ' * ' + position + ' - ' + sumBIT2 + ' = ' + (sumBIT1 * position - sumBIT2) + '</br>';
    cs["lineNo"] = [4]
    stateList.push(cs);

    return sumBIT1 * position - sumBIT2;
  }

  var sumRangeV2 = function(positionLeft,positionRight) {
    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'Computing RSQ([1,' + positionRight + '])';
    cs["lineNo"] = [5];
    stateList.push(cs);
    var sumRight = sumPointV2(positionRight);

    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'Computing RSQ([1,' + (positionLeft - 1) + '])';
    cs["lineNo"] = [5];
    stateList.push(cs);
    var sumLeft = sumPointV2(positionLeft - 1);


    cs = createState(internalAdjList, internalEdgeList);
    cs["status"] = 'RSQ([' + positionLeft + ',' + positionRight + '])';
    cs["status"] += ' = RSQ([1,' + positionRight + ']) - RSQ([1,' + (positionLeft-1) + '])';
    cs["status"] += ' = ' + sumRight + ' - ' + sumLeft + ' = ' + (sumRight - sumLeft);
    cs["lineNo"] = [5];
    stateList.push(cs);

    return true;
  }

  this.sumRangeV2 = function(positionLeft,positionRight) {
    if (positionLeft > positionRight) {
      $(actions[BITType] + '#query-err').html('left position must be smaller or equal to right position');
      return false;
    }
    if (positionLeft <= 0) {
      $(actions[BITType] + '#query-err').html('left position must be between 1 and {numofData} inclusive.'.replace("{numOfData}", numberOfData));
      return false;
    }
    if (positionRight > numberOfData) {
      $(actions[BITType] + '#query-err').html('left position must be between 1 and {numofData} inclusive.'.replace("{numOfData}", numberOfData));
      return false;
    }
    pseudocode = 5;
    stateList = [];

    for (var i = positionLeft; i <= positionRight; ++i)
      internalAdjList[i + 2 * numberOfData]["state"] = VERTEX_HIGHLIGHTED;
    sumRangeV2(positionLeft,positionRight)
    for (var i = positionLeft; i <= positionRight; ++i)
      internalAdjList[i + 2 * numberOfData]["state"] = VERTEX_BLUE_FILL;
    graphWidget.startAnimation(stateList);
    populatePseudocode(pseudocode);
    return true;
  }




  this.create = function(data) {
    if (BITType == POINT_UPDATE_RANGE_QUERY) {
      if (data.length < 2 || data.length > 16) {
        $(actions[BITType] + '#create-err').html('size of data must be between 2 and {limit} inclusive'.replace("{limit}", "16"));
        return false;
      }
      pseudocode = 6;
      stateList = [];
      this.resize(data.length);
      cs = createState(internalAdjList, internalEdgeList);
      cs["status"] = 'resize N = ' + data.length;
      cs["lineNo"] = [1];
      stateList.push(cs);

      for (var i = 0; i < data.length; ++i) {
        cs = createState(internalAdjList, internalEdgeList);
        cs["status"] = 'update([' + (i + 1) + ',' + (i + 1) + ']' + ',' + data[i] + ')';
        cs["lineNo"] = [2,3];
        stateList.push(cs);
        internalAdjList[(i + 1) + numberOfData]["text"] += data[i];
        updatePoint(i+1,data[i]);
      }

      graphWidget.startAnimation(stateList);
      populatePseudocode(pseudocode);
      return true;



    }
    else if (BITType == RANGE_UPDATE_POINT_QUERY) {
      var maxData = 0;
      for (var i = 0; i < data.length; ++i)
        maxData = Math.max(maxData,data[i]);

      if (maxData < 2 || maxData > 15) {
        $(actions[BITType] + '#create-err').html('size of data must be between 2 and {limit} inclusive'.replace("{limit}", "15"));
        return false;
      }
      pseudocode = 6;
      stateList = [];
      ++maxData;
      this.resize(maxData);
      cs = createState(internalAdjList, internalEdgeList);
      cs["status"] = 'resize N = ' + maxData;
      cs["lineNo"] = [1];
      stateList.push(cs);

      for (var i = 0; i < data.length; i += 2) {
        if (data[i] > data[i+1]) {
          $(actions[BITType] + '#create-err').html('left interval must be smaller than or equal to right interval');
          return false;
        }
        for (var j = data[i]; j <= data[i+1]; ++j) {
          internalAdjList[j + numberOfData]["text"] += 1;
          internalAdjList[j + numberOfData]["state"] = VERTEX_HIGHLIGHTED;
        }
        cs = createState(internalAdjList, internalEdgeList);
        cs["status"] = 'update([' + (data[i]) + ',' + (data[i+1]) + ']' + ',' + 1 + ')';
        cs["lineNo"] = [2,3];
        stateList.push(cs);

        for (var j = data[i]; j <= data[i+1]; ++j)
          internalAdjList[j + numberOfData]["state"] = VERTEX_BLUE_FILL;

        updateRange(data[i],data[i+1],1);
      }

      graphWidget.startAnimation(stateList);
      populatePseudocode(pseudocode);
      return true;



    }
    else if (BITType == RANGE_UPDATE_RANGE_QUERY) {
      var maxData = 0;
      for (var i = 0; i < data.length; ++i)
        maxData = Math.max(maxData,data[i]);

      if (maxData < 2 || maxData > 15) {
        $(actions[BITType] + '#create-err').html('size of data must be between 2 and {limit} inclusive'.replace("{limit}", "15"));
        return false;
      }
      pseudocode = 6;
      stateList = [];
      ++maxData;
      this.resize(maxData);
      cs = createState(internalAdjList, internalEdgeList);
      cs["status"] = 'resize N = ' + maxData;
      cs["lineNo"] = [1];
      stateList.push(cs);

      for (var i = 0; i < data.length; i += 2) {
        if (data[i] > data[i+1]) {
          $(actions[BITType] + '#create-err').html('left interval must be smaller than or equal to right interval');
          return false;
        }
        for (var j = data[i]; j <= data[i+1]; ++j) {
          internalAdjList[j + 2 * numberOfData]["text"] += 1;
          internalAdjList[j + 2 * numberOfData]["state"] = VERTEX_HIGHLIGHTED;
        }
        cs = createState(internalAdjList, internalEdgeList);
        cs["status"] = 'update([' + (data[i]) + ',' + (data[i+1]) + ']' + ',' + 1 + ')';
        cs["lineNo"] = [2,3];
        stateList.push(cs);

        for (var j = data[i]; j <= data[i+1]; ++j)
          internalAdjList[j + 2 * numberOfData]["state"] = VERTEX_BLUE_FILL;

        updateRangeV2(data[i],data[i+1],1,3);
      }

      graphWidget.startAnimation(stateList);
      populatePseudocode(pseudocode);
      return true;
    }
  }

  function createState(internalAdjListObject, internalEdgeListObject, vertexHighlighted, edgeRed, vertexTraversed, edgeYellow, edgeBlue, edgeGrey){
    if(vertexHighlighted == null) vertexHighlighted = {};
    if(edgeRed == null) edgeRed = {};
    if(vertexTraversed == null) vertexTraversed = {};
    if(edgeYellow == null) edgeYellow = {};
    if(edgeBlue == null) edgeBlue = {};
    if(edgeGrey == null) edgeGrey = {};

    var key;
    var state = {
      "vl":{},
      "el":{}
    };

    for(key in internalAdjListObject) {
      state["vl"][key] = {};

      state["vl"][key]["cx"] = internalAdjListObject[key]["cx"];
      state["vl"][key]["cy"] = internalAdjListObject[key]["cy"];
      state["vl"][key]["text"] = internalAdjListObject[key]["text"];
      state["vl"][key]["extratext"] = internalAdjListObject[key]["extratext"];
      state["vl"][key]["state"] = internalAdjListObject[key]["state"];
    }

    for(key in internalEdgeListObject) {
      state["el"][key] = {};

      state["el"][key]["vertexA"] = internalEdgeListObject[key]["vertexA"];
      state["el"][key]["vertexB"] = internalEdgeListObject[key]["vertexB"];
      state["el"][key]["type"] = EDGE_TYPE_UDE; // HOW TO MAKE THIS DIRECTED?
      state["el"][key]["weight"] = 0;
      state["el"][key]["state"] = internalEdgeListObject[key]["state"];
      state["el"][key]["displayWeight"] = false;
      state["el"][key]["animateHighlighted"] = false;
      state["el"][key]["animateHighlighted"] = internalEdgeListObject[key]["animateHighlighted"]
    }

    for(key in vertexHighlighted) {
      state["vl"][key]["state"] = VERTEX_HIGHLIGHTED;
    }

    for(key in edgeRed){
      state["el"][key]["state"] = EDGE_RED;
    }

    for(key in vertexTraversed) {
      state["vl"][key]["state"] = VERTEX_TRAVERSED;
    }

    for(key in edgeYellow){
      state["el"][key]["state"] = EDGE_TRAVERSED;
    }

    for(key in edgeBlue){
      state["el"][key]["state"] = EDGE_BLUE;
    }

    for(key in edgeGrey){
      state["el"][key]["state"] = EDGE_GREY;
    }

    return state;
  }
  
  function populatePseudocode(act) {
    switch (act) {
      case 0: // UPDATE POINT_UPDATE_RANGE_QUERY
        $('#code1').html('Create the updating tree');
        $('#code2').html('while position <= N');
        $('#code3').html('&nbsp;&nbsp;BIT[position] += value');
        $('#code4').html('&nbsp;&nbsp;position += LSOne(position)');
        $('#code5').html('');
        $('#code6').html('');
        $('#code7').html('');
        break;
      case 1: // QUERY POINT_UPDATE_RANGE_QUERY
        $('#code1').html('Create the interrogation tree');
        $('#code2').html('function RSQ(1,position)');
        $('#code3').html('&nbsp;&nbsp;RSQ = 0');
        $('#code4').html('&nbsp;&nbsp;while position > 0');
        $('#code5').html('&nbsp;&nbsp;&nbsp;&nbsp;RSQ += BIT[position]');
        $('#code6').html('&nbsp;&nbsp;&nbsp;&nbsp;position -= LSOne(position)');
        $('#code7').html('RSQ(a, b) = RSQ(1, b) - RSQ(1, a-1)');
        break;
      case 2: // UPDATE RANGE_UPDATE_POINT_QUERY
        $('#code1').html('function update(position,value)');
        $('#code2').html('&nbsp;&nbsp;Create the updating tree');
        $('#code3').html('&nbsp;&nbsp;while position <= N');
        $('#code4').html('&nbsp;&nbsp;&nbsp;&nbsp;BIT[position] += value');
        $('#code5').html('&nbsp;&nbsp;&nbsp;&nbsp;position += LSOne(position)');
        $('#code6').html('update(L, val)');
        $('#code7').html('update(R+1, -val)');
        break;
      case 3: // QUERY RANGE_UPDATE_POINT_QUERY
        $('#code1').html('function RSQ(1,position)');
        $('#code2').html('&nbsp;&nbsp;Create the interrogation tree');
        $('#code3').html('&nbsp;&nbsp;RSQ = 0');
        $('#code4').html('&nbsp;&nbsp;while position > 0');
        $('#code5').html('&nbsp;&nbsp;&nbsp;&nbsp;RSQ += BIT[position]');
        $('#code6').html('&nbsp;&nbsp;&nbsp;&nbsp;position -= LSOne(position)');
        $('#code7').html('data[position] = RSQ(1,position)');
        break;
      case 4: // UPDATE RANGE_UPDATE_RANGE_QUERY
        $('#code1').html('function update([a,b],value)');
        $('#code2').html('&nbsp;&nbsp;update (BIT1,a,    value        )');
        $('#code3').html('&nbsp;&nbsp;update (BIT1,b+1, -value        )');
        $('#code4').html('&nbsp;&nbsp;update (BIT2,a,    value * (a-1))');
        $('#code5').html('&nbsp;&nbsp;update (BIT2,b+1, -value * b    )');
        $('#code6').html('');
        $('#code7').html('');
        break;
      case 5: // QUERY RANGE_UPDATE_RANGE_QUERY
        $('#code1').html('function RSQ([1,x])');
        $('#code2').html('&nbsp;&nbsp;a = RSQ([1,x]) on BIT1');
        $('#code3').html('&nbsp;&nbsp;b = RSQ([1,x]) on BIT2');
        $('#code4').html('&nbsp;&nbsp;return a*x - b');
        $('#code5').html('RSQ([x,y]) = RSQ([1, y]) - RSQ([1, x-1])');
        $('#code6').html('');
        $('#code7').html('');
        break;
      case 6: // Create
        $('#code1').html('resize N = data.length');
        $('#code2').html('for i : 1 to N');
        $('#code3').html('&nbsp;&nbsp;update(i,data[i])');
        $('#code4').html('');
        $('#code5').html('');
        $('#code6').html('');
        $('#code7').html('');
        break;
    }
  }
}



// Fenwick Tree actions
var actionsWidth = 150;
var statusCodetraceWidth = 410;

var isUpdateOpen = false;
var isQueryOpen = false;
var isCreateOpen = false;

function openCreate() {
  if (!isCreateOpen) {
    randomize();
    $('.create').fadeIn('fast');
    isCreateOpen = true;
  }
}

function closeCreate() {
  if (isCreateOpen) {
    $('.create').fadeOut('fast');
    $(actions[BITType] + '#create-err').html("");
    isCreateOpen = false;
  }
}

function openUpdate() {
  if (!isUpdateOpen) {
    $('.update').fadeIn('fast');
    isUpdateOpen = true;
  }
}

function closeUpdate() {
  if (isUpdateOpen) {
    $('.update').fadeOut('fast');
    $(actions[BITType] + '#update-err').html("");
    isUpdateOpen = false;
  }
}

function openQuery() {
  if (!isQueryOpen) {
    $('.query').fadeIn('fast');
    isQueryOpen = true;
  }
}

function closeQuery() {
  if (isQueryOpen) {
    $('.query').fadeOut('fast');
    $(actions[BITType] + '#query-err').html("");
    isQueryOpen = false;
  }
}

function hideEntireActionsPanel() {
  closeUpdate();
  closeQuery();
  closeCreate();
  hideActionsPanel();
}



// local
var BITWidget, gw, actions;

$(function() {
  $('#play').hide();
  BITWidget = new BIT();
  gw = BITWidget.getGraphWidget();
  actions = [".point-update-range-query-actions ",".range-update-point-query-actions ",".range-update-range-query-actions "];
  BITType = POINT_UPDATE_RANGE_QUERY;
  BITWidget.resize(10);
  BITWidget.fill();
  // BITWidget.sumRange(1,7);
  $('.range-update-point-query-actions').fadeOut('fast');
  $('.range-update-range-query-actions').fadeOut('fast');

  $('#point-update-range-query').click(function() {
    if(isPlaying) { stop(); }
    hideEntireActionsPanel();
    hideStatusPanel();
    hideCodetracePanel();
    BITType = POINT_UPDATE_RANGE_QUERY;
    BITWidget.resize(6);
    BITWidget.fill();
    $('.point-update-range-query-actions').fadeIn('fast');
    $('.range-update-point-query-actions').fadeOut('fast');
    $('.range-update-range-query-actions').fadeOut('fast');
  });

  $('#range-update-point-query').click(function() {
    if(isPlaying) { stop(); }
    hideEntireActionsPanel();
    hideStatusPanel();
    hideCodetracePanel();
    BITType = RANGE_UPDATE_POINT_QUERY;
    BITWidget.resize(6);
    BITWidget.fill();
    $('.point-update-range-query-actions').fadeOut('fast');
    $('.range-update-point-query-actions').fadeIn('fast');
    $('.range-update-range-query-actions').fadeOut('fast');
  });

  $('#range-update-range-query').click(function() {
    if(isPlaying) { stop(); }
    hideEntireActionsPanel();
    hideStatusPanel();
    hideCodetracePanel();
    BITType = RANGE_UPDATE_RANGE_QUERY;
    BITWidget.resize(6);
    BITWidget.fill();
    $('.point-update-range-query-actions').fadeOut('fast');
    $('.range-update-point-query-actions').fadeOut('fast');
    $('.range-update-range-query-actions').fadeIn('fast');
  });

  $('#update').click(function(){
    closeQuery();
    closeCreate();
    openUpdate();
  });

  $('#query').click(function(){
    closeUpdate();
    closeCreate();
    openQuery();
  });

  $('#create').click(function(){
    closeUpdate();
    closeQuery();
    openCreate();
  });
});

function resize(size) {
  if (isPlaying) stop();
  BITWidget.resize(size);
}

function create() {
  var text = $(actions[BITType] + '#create-input-data').val();
  var data = text.split(',');
  if (BITType == POINT_UPDATE_RANGE_QUERY) {
    for (var i = 0; i < data.length; ++i)
      data[i] = (+data[i]);
  }
  else if (BITType == RANGE_UPDATE_POINT_QUERY || BITType == RANGE_UPDATE_RANGE_QUERY) {
    for (var i = 0; i < data.length; ++i) {
      if (data[i][0] == '[')
        data[i] = +(data[i].substr(1,data[i].length-1));
      else if (data[i][data[i].length-1] == ']')
        data[i] = +(data[i].substr(0,data[i].length-1));
      else data[i] = +data[i];
    }
  }

  if (isPlaying) stop();
  setTimeout(function() {
    if ((mode == "exploration") && BITWidget.create(data)) {
      $('#current-action').show();
      $('#current-action p').html("创建(" + text + ")");
      $('#progress-bar').slider( "option", "max", gw.getTotalIteration()-1);
      triggerRightPanels();
      isPlaying = true;
    }
  }, 500);
}

function updatePoint() {
  var position = +($(actions[BITType] + '#update-input-point').val());
  var value = +($(actions[BITType] + '#update-input-value').val());
  if(isPlaying) stop();
  setTimeout(function() {
    if ((mode == "exploration") && BITWidget.updatePoint(position, value)) {
      $('#current-action').show();
      $('#current-action p').html("更新(["+position+","+position+"],"+value+")");
      $('#progress-bar').slider( "option", "max", gw.getTotalIteration()-1);
      triggerRightPanels();
      isPlaying = true;
    }
  }, 500);
}

function updateRange() {
  var positionLeft = +($(actions[BITType] + '#update-input-left').val());
  var positionRight = +($(actions[BITType] + '#update-input-right').val());
  var value = +($(actions[BITType] + '#update-input-value').val());
  if(isPlaying) stop();
  setTimeout(function() {
    if ((mode == "exploration") && BITWidget.updateRange(positionLeft, positionRight, value)) {
      $('#current-action').show();
      $('#current-action p').html("更新(["+positionLeft+","+positionRight+"],"+value+")");
      $('#progress-bar').slider( "option", "max", gw.getTotalIteration()-1);
      triggerRightPanels();
      isPlaying = true;
    }
  }, 500);
}

function sumRange() {
  var positionLeft = +($(actions[BITType] + '#query-input-left').val());
  var positionRight = +($(actions[BITType] + '#query-input-right').val());
  if (isPlaying) stop();
  setTimeout(function() {
    if ((mode == "exploration") && BITWidget.sumRange(positionLeft,positionRight)) {
      $('#current-action').show();
      $('#current-action p').html("RSQ(["+positionLeft+","+positionRight+"])");
      $('#progress-bar').slider( "option", "max", gw.getTotalIteration()-1);
      triggerRightPanels();
      isPlaying = true;
    }
  }, 500);
}

function sumPoint() {
  var position = +($(actions[BITType] + '#query-input-point').val());
  if (isPlaying) stop();
  setTimeout(function() {
    if ((mode == "exploration") && BITWidget.sumPoint(position)) {
      $('#current-action').show();
      $('#current-action p').html("RSQ(["+position+","+position+"])");
      $('#progress-bar').slider( "option", "max", gw.getTotalIteration()-1);
      triggerRightPanels();
      isPlaying = true;
    }
  }, 500);
}

function updateRangeV2() {
  var positionLeft = +($(actions[BITType] + '#update-input-left').val());
  var positionRight = +($(actions[BITType] + '#update-input-right').val());
  var value = +($(actions[BITType] + '#update-input-value').val());
  if(isPlaying) stop();
  setTimeout(function() {
    if ((mode=="exploration")&&BITWidget.updateRangeV2(positionLeft, positionRight, value)) {
      $('#current-action').show();
      $('#current-action p').html("更新(["+positionLeft+","+positionRight+"],"+value+")");
      $('#progress-bar').slider( "option", "max", gw.getTotalIteration()-1);
      triggerRightPanels();
      isPlaying = true;
    }
  }, 500);
}

function sumRangeV2() {
  var positionLeft = +($(actions[BITType] + '#query-input-left').val());
  var positionRight = +($(actions[BITType] + '#query-input-right').val());
  if(isPlaying) stop();
  setTimeout(function() {
    if ((mode == "exploration") && BITWidget.sumRangeV2(positionLeft, positionRight)) {
      $('#current-action').show();
      $('#current-action p').html("RSQ(["+positionLeft+","+positionRight+"])");
      $('#progress-bar').slider( "option", "max", gw.getTotalIteration()-1);
      triggerRightPanels();
      isPlaying = true;
    }
  }, 500);
}

function randomize() {
  var text = '';
  if (BITType == POINT_UPDATE_RANGE_QUERY) {
    var N = Math.floor(Math.random() * 14) + 2;
    for (var i = 0; i < N; i++) {
      var x = Math.floor(Math.random() * 100);
      if (i > 0) text += ',';
      text += x;
    }
  }
  else if (BITType == RANGE_UPDATE_POINT_QUERY || BITType == RANGE_UPDATE_RANGE_QUERY) {
    var intervals = Math.floor(Math.random() * 5) + 2;
    for (var i = 0; i < intervals; i++) {
      var y = Math.floor(Math.random() * 14) + 2;
      var x = Math.floor(Math.random() * (y-1)) + 2;
      if (i > 0) text += ',';
      text += '[' + x + ',' + y + ']';
    }
  } 
  $(actions[BITType] + '#create-input-data').val(text);
}
</script>
</body>
</html>
