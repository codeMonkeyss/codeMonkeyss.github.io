<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />

<link rel="stylesheet" href="../css/book.css" />
<script src="../js/book.js"></script>

<style>
pre.reveal { }  /* mark pre that should get this setup */
span.phide { display:none; }
span.pshow { color:darkgreen;} /* display:inline; */
</style>

</head>
<body>

<nav><div id="toc"></div></nav>

<main>

<h1>Python Style Part 1 - PEP8</h1>

<p>CS106A does not just teach coding. It has always taught how to write <i>clean</i> code with good style.
Your section leader will talk with you about the correctness of code, but also pointers for good style.</p>

<p>Messy code works poorly &mdash; hard to read, hard to debug. To help you develop the right habits, we want you to always turn in clean code, and of course all of our examples should also have good clean style.</p>

<h1>The Word is Readable</h1>

<p>The goal of good style is "readable" code, meaning that when someone sweeps their eye over the code, what that code does shines through.</p>

<p>Experience has shown that readable code is less time consuming to build and debug. Debugging especially can be a huge time-sink, so learning to write clean code and keep it clean is how we will do things all the time. Like surgeons keeping their hands clean, it's the right way to do it and we will try to develop the habit all the time.</p>

<!-- could mention the principle of least surprise which is congruent with readable here -->

<!-- xx possible Aside: the black hole gravity well of messy style -->

<h2>Readability 1 - Function and Variable Names</h2>

<p>The first step to good readability is a good variable and function names, like this example:</p>

<pre>
...
url = get_browser_url()
if has_security_problem(url):
    display_alert('That url looks sketchy!')
else:
    html = download_url(url)
    display_html(html)
...
</pre>

<p>The narrative steps the code takes are apparent from the good function and variable names (essentially the verbs and nouns in the narrative). No other comments are necessary here. The names alone make it very readable.</p>

<p>The functions are the actions in the code, so we prefer verb names like "display_alert" or "remove_url" that say what the function does. Variables are like the nouns of the code, so we prefer names that reflect what that variable stores like "urls" or "original_image" or "resized_image". We'll talk about naming in more detail in the Style 2 document.</p>

<!--
<p>The second
 Readability stems from choosingExperience shows that the best code is "readable" - someone sweeping their eye over it can see what it does and how its parts fit together.</p>

<p>xx talk about var and fn naming .. does that go here or later?</p>
-->

<h2>Readability 2 - PEP8 Tactics</h2>

<p>Python is developed as a collaborative, free and open source project. A "PEP" (Python Enhancement Proposal) is a written proposal used in Python development.</p>

<p>One of the earliest PEPs, <a href="https://www.python.org/dev/peps/pep-0008/">PEP8</a>, is a consensus set of style and formatting rules for writing "standard" style Python, so your code has the right look for anyone else reading or modifying it. This is very much like English spelling reform, where "public" is the standard spelling, and "publick" is out of use and looks weird.</p>

<p>Here are the most important PEP8 rules we will use. The code you turn in should abide by PEP8.</p>

<!--
<p>xx could talk about Bike Shed https://en.wikipedia.org/wiki/Law_of_triviality</p>
-->

<span id="indent"></span>
<h3>Indent 4 Spaces</h3>

<p>Indent code logically using spaces &mdash; 4 spaces is the most common.
For if/for/while .. write "body" lines indented on the next line after the colon.
Early in the life of Python, some programs used 2 spaces and some used 4 spaces, but 4 spaces has grown to dominate. The best practice is to use literal spaces to indent the code, not tab stops.</p>

<pre>
if color == 'red':
    color = 'green'
    print(color)
</pre>

<span id="singlespace"></span>
<h3>Single Space Between Items</h3>

<p>Most lines of code have a mix of variables and "operators" such as as <code class="b">+ * / = >=</code>. Use a single space to separate the operators and items:</p>

<pre>
bound = x * 12 + 13
if x >= 4:
    print(x + 2)
</pre>

<!--
<li>(<i>exception</i>) possibly helpful to vary spaces to reflect precedence
<pre>
a * b + c + c * d    # strict PEP8 spacing
a*b + c + c*d        # OK with this if done logically
</pre>

<p>exception for named parameters I think</p>
-->

<span id="spaceafter"></span>
<h3>Space After Comma/Colon</h3>

<p>A comma or colon has 1 space after it, but no spaces before it.</p>

<pre>
# e.g.
foo(1, 'hello', 42)  # params to a fn call
[1, 2, 3]            # e.g. list
{'a': 1, 'b': 2}     # e.g. dict
</pre>

<span id="parenthesis"></span>
<h3>Parenthesis No Space</h3>

<p>The left and right parenthesis are not separated from what they contain, and the parenthesis for a function call is not separated from the name of the function. Similarly, square brackets and curly braces are not separated from what they contain.</p>

<pre>
func(1, 2 * (x + 1), y ** 10)
lst = [1, 2, z * 6]
</pre>

<span id="quote"></span>
<h3>Use a Consistent Quote Mark</h3>

<p>Python strings can be written within single quotes like <code>'Hello'</code> or double quotes like
<code>"there"</code>. PEP8 requires a program to pick one quote style and use it consistently. For CS106A, we recommend just using single quote. Single quote is tiny bit easier since it does not require the shift key. Not thinking about which quote mark to use will free up valuable brain cells for something.
</p>

<span id="twoblank"></span>
<h3>2 Blank Lines Before Def</h3>

<p>PEP8 requires 2 blank lines before each def in a file. This is one of the weaker PEP8 rules. We will not be very upset about your code if it has 3 lines between functions.</p>


<h3>Blank Lines Within a Def</h3>

<p>If the lines of code have have natural phases &mdash; a few lines setting up the file, a few lines sorting the keys &mdash; use blank lines within the def to separate these phases from each other, much like dividing an essay into paragraphs. The standard says to use blank lines "sparingly".</p>

<span id="notequal"></span>
<h3>Prefer <code>!=</code> and <code>not in</code></h3>

<p>This is a preference between two equivalent forms which both work correctly. We prefer the "shortcut" forms for not-equal and not-in testing, like this:</p>

<pre>
if not s == 'donut':        # NO
    ...

if s != 'donut':            # YES
    ...


if not 'donut' in foods:    # NO
    ...

if 'donut' not in foods:    # YES
    ...
</pre>

<p>These forms arrange the code more in line with the natural phrasing, like "s is not donut" or "donut is not in foods".</p>

<span id="equaltrue"></span>
<h3>Do Not Write: if x == True</h3>

<p>The way that boolean True/False is evaluated in an if/while test is a little more complicated than it appears. The simple rule is this: do not write <code>if x == True</code> or <code>if x == False</code> in an if/while test.</p>

<p>Say we have a <code>print_greeting()</code> function that takes in a <code>shout_mode</code> parameter.</p>

<p>Do not write this:</p>

<pre>
def print_greeting(words, shout_mode):
    if shout_mode == True:   # NO not like this
        print(words.upper())
    else
        print(words)
</pre>


<p>The <code>if</code> structure can distinguish True vs. False values itself. Therefore, write the code to give the boolean <code>shout_mode</code> to the <code>if</code> directly, like this:</p>

<pre>
def print_greeting(words, shout_mode):
    if shout_mode:           # YES like this
        print(words.upper())
    else:
        print(words)
</pre>

<p>To invert the logic do not use <code>== False</code>. Use <code class="b">not</code> like this:</p>

<pre>
def print_greeting(words, shout_mode):
    if not shout_mode:
        print('Not shouting')
    else:
        print(words)
</pre>

<span id="pass"></span>
<h3>Remove Pass from Code</h3>

<p>The <code>pass</code> directive in Python is a placeholder line that literally does nothing. It is very rarely used in regular production code. However, in coding exercises, there is often some boilerplate code with a <code>pass</code> marking the spot for the student code. Remove all the <code>pass</code> markers from your code before turning it in.</p>


<span id="inline"></span>
<h3># Inline Comments</h3>

<p>It's a good practice to add # "inline" comments to explain
what especially non-obvious or interesting code does.
Inline comments are not needed when the code itself does a good
job of showing what the line does.</p>

<p>1. For the following lines, the code does a good job of telling
the story, so no inline comments are needed beyond the good variable
and function names. Most lines of code are like this.</p>

<pre>
count += 1
total_len = len(name) + len(address)
</pre>

<p>In particular, avoid putting in a comment that restates what the code itself says.</p>

<pre>
i += 1  # add 1 to i
</pre>

<p>2. Inline comments are appropriate as in the
example below, explaining
what a non-obvious bit of code <i>accomplishes</i> -
addressing the goal at work, not the re-stating the operators used.</p>

<pre>
# increase i to the next multiple of 10
i = 10 * (i // 10 + 1)
</pre>

<p>See how the
inline comment provides useful information
that is not obvious from the line itself.</p>

<p>3. Another important use of inline comments
to note when the code does <b>not</b> do what it
appears to. This speaks to readability -
the code does not do what its variable and function
names suggest, so an inline comment
can help clear things up.</p>

<pre>
vendors.add('AT&T')
vendors.add('Stanford University')
vendors.add('T-Mobile')
# Note: We pass 'T-Mobile' here, but for historical
# reasons the payment system re-writes and uses
# 'Vodafone' for this internally.
</pre>

<p>Example code used in teaching often has more inline comments than regular production code, since for teaching there are many times we want to point out or explain a technique shown on a line.</p>

<!--
<h3>Constants For Repeated Values</h3>

<p>TBD</p>
-->

<!--
TBD

<li>Functions should have a """comment like this""" explaining
what the function does with its inputs, i.e. its pre and post conditions.
<li>Teaching exception: sometimes what a function does in class is defined on another page,
in which case we don't repeat that in the """
-->

<h2>Named Parameter Exception</h2>

<p>There is an exception to the 1-space-between-items rule, but it's for a rare case. If a function call has named parameters, no spaces are needed around the <code>=</code> like this:</p>

<pre>
print('hi', end='')
</pre>

<p>I think the reasoning here is that this use of <code>=</code> is different the more common variable assignment <code>=</code>, so it's good to make this use look a little different.</p>


<h3>The Misguided PEP8 Rule About ==</h3>

<p>How do you compare two values in Python? The answer is: use the <code>==</code> operator
like this:</p>

<pre>
if word == 'meh':
    print('Enthusiasm low')
</pre>

<p>It works for strings, it works for ints, it works for lists, it works for pretty much everything. Having nailed down that <code>==</code> is the simple, correct thing that should come to mind when comparing two values, you may skip the following paragraph and simply use <code>==</code> with an uncluttered mind.</p>

<p>There is a IMHO misguided requirement in PEP8: it requires that comparisons to the special value None use the obscure <code>is</code> operator instead of <code>==</code>. That is a bad idea, since comparing to None is pretty common, but the <code>is</code> operator is quite obscure. In fact  it's unusual for a program to have any need for the <code>is</code> operator at all.
Forcing the mass of regular programs to use this boutique operator most people have never heard of and will never need is not good Python. Therefore, the CS106A position it to just use <code>==</code> to compare any two values, which is the simple, intuitive way to think about comparisons.</p>

<pre>
if val == None:  # CS106A says this is fine
    print('Is nothing sacred?')
</pre>

<hr />

<p>Naming quirks:</p>

<h3>Python Keywords</h3>

<p>A few words like <code>def</code>, <code>for</code>, and <code>if</code> are fixed "keywords" in Python, so you cannot use those words as variable or function names. Here is the list of keywords:</p>

<pre>
>>><b> import keyword</b>
>>><b> keyword.kwlist</b>
['False', 'None', 'True', 'and', 'as', 'assert', 'async', 'await', 'break', 'class', 'continue', 'def', 'del', 'elif', 'else', 'except', 'finally', 'for', 'from', 'global', 'if', 'import', 'in', 'is', 'lambda', 'nonlocal', 'not', 'or', 'pass', 'raise', 'return', 'try', 'while', 'with', 'yield']
</pre>

<span id ="lenrule"></span>
<h3>The "len" Rule: Do Not Use Builtin Functions as a Variable Names</h3>

<p>Python has many  built-in functions like <code>len()</code> and <code>min()</code>. As a strange example of Python's flexibility, your code can use assignment <code class="b">=</code> to change what <code>len</code> means within your code .. probably a huge mistake!</p>

<pre>
>>><b> len('hello')  </b> # len function works
5
>>><b> len = 7       </b> # redefine "len" to be 7, bad idea
>>><b> len('hello')  </b> # oh noes!
TypeError: 'int' object is not callable
</pre>

<p>Here is the simple rule: do not use the name of a common function as a variable name. Here are the most common function names:</p>

<pre>
len abs min max int float list str dict range map filter format
</pre>

<p>Rather than memorize the list of all the function names to avoid, it is sufficient to avoid using the names of functions that <i>your code uses</i>, typically the well known functions like <code>len</code>, <code>range</code>, <code>min</code>, and so on.</p>

<p>Incidentally, this is why we avoid using "str" or "list" as variable names, instead using "s" and "lst".</p>

<p>Redefining a function in this way only affects your local code, not code elsewhere in the program. So if your code accidentally defines a variable named <code>divmod</code>, that will not interfere with code in another function calling <code>divmod()</code>.</p>

<h2>A Little Readability Joke</h2>

<p>This is an optional point for anyone who reads this far down. What does readability mean? One could say it means the visuals of the code fit with the semantics of what it's going to do.</p>

<p>With that in mind, what do you think about this code that computes a total score, but the spacing technically violates PEP8:</p>

<pre>
total = score*10 + bonus*2
</pre>

<p>I'd say it looks ok. The spaces are missing, but the missing spaces are in agreement with the precedence &mdash; the multiplication will happen first, and the missing spaces sort of reinforce that.</p>

<p>What about this version?</p>

<pre>
total = score * 10+bonus * 2
</pre>

<p>You may have chuckled or winced a little looking at this one. It is just so <i>wrong</i>, sort of like the punchline of a joke. This may give you a little insight that the meaning of code and its appearance have some deep linkage. Given that linkage, it's maybe not surprising that messy looking code is more prone to confusion and bugs.</p>

<h2>Links For SLs</h2>

<p>Here are links to the sections for particular style rules, handy for pasting into grading notes.</p>

<ul>
<li><a href="#indent">indent 4</a>
<li><a href="#singlespace">single space between</a>
<li><a href="#spaceafter">space after</a>
<li><a href="#parenthesis">parenthesis no space</a>
<li><a href="#quote">quote</a>
<li><a href="#twoblank">two blank</a>
<li><a href="#notequal">not equal</a>
<li><a href="#equaltrue">equal true</a>
<li><a href="#pass">pass</a>
<li><a href="#inline">inline</a>
<li><a href="#lenrule">len rule</a>
</ul>


<!--
more style

<h2>Programming Style - Readable</h2>

<p>Experience shows that the best code is "readable" - someone sweeping their eye over it can see what it does and how its parts fit together.</p>

<h3>Variable Names</h3>

<p>A good variable names reflects what data it holds so lines with that data make sense. Typing a very long variable name is a chore, so we want a name just long enough to show what's going on; 's2' is not good, but 'start' or 'mid' are enough.</p>

<p>Below is an example from the midterm review - lots of string variables. If they had names like s1 s2 s3 it's a lot harder to get right. Creating meaningful+short variable names lets the programmer narrate their own ideas as they write each line.
The last line is a nice example of names supporting the code. We would say that the code "reads" nicely, showing what it does.</p>

<p><b>foo() Example Function Problem</b> - Given a string s of even length, if the string length is 2 or less, return it unchanged. Otherwise take off the first and last chars. Consider the remaining middle piece. Split the middle into front and back halves. Swap the order of these two halves, and return the whole thing with the first and last chars restored. So 'x1234y' yields 'x3412y'.</p>

<pre>
def foo(s):
    if len(s) <= 2:
        return s
    first = s[0]
    last = s[len(s)-1]
    mid = s[1:len(s)-1]
    halfway = len(mid) // 2  # index of halfway
    return first + mid[halfway:] + mid[:halfway] + last
</pre>

<h3>Allowable 1-Letter Names</h3>

<p>In a real program, most variables are not 1-letter, since the variables are carrying real data around, and the variable name reflects that type of data. <b>But</b> there are a few idiomatic uses where the 1-letter variable is quite readable, as the 1-letter form is a kind of standard for certain situations:</p>

<ul>
<li> i - int counter over linear collection, often 0..len-1 (j and k also)
<li> n - an int value without semantics (more typically you know
what the value represents like 'weight' or 'height')
<li> x y - referring to x y coordinates in a 2d space
<li> f - file handle for <code>open(filename, 'r') as f</code>
<li> s - a string with no particular content
<br /> if the string is an ip address we would use 'ip' as its name,
but some algorithms take in a string with zero semantics, in which case 's' is ok.
<li> d - a dict with no semantics. This maybe just happens in demos
of dict functions (such as in the official python docs), as a dict in a real program will have semantics that suggest a real name like 'counts'.
</ul>

<h3>Collection Data Structures - 's'</h3>

<p>Variable names for lists, dicts, .. that hold many things work well with 's' at the end. One sign this is working well is writing the foreach loop, and the logic of the names confirms you have it right:</p>

<pre>
<h1>e.g. 'lines' is a list of text lines from a file</h1>
<p>for line in lines:
    ...
</p>

<h1>e.g. 'nums' is a list of int values</h1>
<p>for num in nums:
    ...
</p>

<h1>e.g. 'weights' is a list of weight values</h1>
<p>for weight in weights:
    ...
</p>

<h1>e.g. 'word_counts' is a dict mapping word -> count</h1>
<p>for word in word_counts.keys():
    count = word_counts[word]
    ...
</p>
</pre>

<h3>Names vs. Bugs - Time Saver!</h3>

<p>Tracking down bugs is a very time consuming. Often a bug creeps in when you lose track of - a word vs. a list of words vs. a dict of lists of words. Being careful with your variable names as you go code up your steps can be a big time saver by cutting down on these bugs.</p>

<h3>Function Decomposition</h3>

<p>Decomposition refers to separating out smaller functions to compute sub-parts of the big problem. Divide and conquer!</p>

<ul>
<li> Shorter = easier! Don't write a 100 line program. Much easier to write a series of 10 line functions.
<li> A decomposed function should try to solve a single, independent problem. Ideally the problem is as independent as possible, not entangled with specifics of the larger program. (independence makes it easier to write, easier to test, easier to re-use).
<li> Separate testing - can write a test for the 10 line function. The 100 line program is much harder to debug as one big lump.
<li> Re-use - sometimes the 10-line function can be called called from multiple spots, re-using its capability (one indication that this sort of re-use may be possible is copy-pasting code into 2 or more sections of a program).
</ul>

<hr />

<h2>Style Strategy - Decomposition</h2>

<ul class="slide">
<li>Decomposition - this story will develop over the weeks
<li>Program - made of functions
<li>Divide and Conquer
<li>Divide problem into separate functions
<liMesh these functions together
<li>Today: decompose out a helper function
< !--
<br />A function solves a sub-problem
<br />aka a "helper function"
<br />Code calls that function when that sub-problem appears
<li>Each function has pre/post conditions
<li>Advantage: easier to write shorter code
<li>Advantage: don't have to write code again, just call your function

</ul>

<h2>Top-Down Decomposition Strategy</h2>

<ul class="slide">
<li>Earlier examples showed how a program is made of many functions
<li>e.g. beloved
<li>Now .. how to think up these functions?
<li>Top-Down Decomposition recipe:
<li>We have problem X to solve
<li>Thinking up the code for solve_x() function
<li>Q: what would be useful helper function here?
<li>Q: something I could call to solve a sub-part of the problem?
<li>What should be the pre and post conditions of the helper?
<li>e.g. say we think up a function called helper()
<li>1. Write the code for solve_x(), calling helper()
<li>2. Now go implement the code for helper() too
</ul>
-->

<p>&nbsp;</p>

<p class="small">Copyright 2020 Nick Parlante</p>

</main>

</body>
</html>
